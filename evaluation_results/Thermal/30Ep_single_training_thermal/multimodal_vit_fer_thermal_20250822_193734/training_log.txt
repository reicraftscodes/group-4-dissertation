2025-08-22 19:37:51,142 - INFO - Class weights: tensor([0.7590, 2.6634, 1.6918, 0.4908, 5.9129, 0.6691, 0.9855],
       device='cuda:0')
2025-08-22 19:37:51,166 - INFO - Trainer initialized. Experiment: multimodal_vit_fer_thermal_20250822_193734
2025-08-22 19:37:51,168 - INFO - Save directory: ./experiments/multimodal_vit_fer_thermal_20250822_193734
2025-08-22 19:37:51,170 - INFO - Training mode: thermal
2025-08-22 19:37:51,171 - INFO - Training samples: 16,556
2025-08-22 19:37:51,171 - INFO - Test samples: 4,139
2025-08-22 19:37:51,172 - INFO - Use augmented data: True
2025-08-22 19:37:51,173 - INFO - Training configuration: {
  "data_dir": "Data",
  "output_dir": "./experiments",
  "mode": "thermal",
  "fusion_strategy": "",
  "fusion_type": "",
  "fusion_layer": "",
  "model_name": "google/vit-base-patch16-224-in21k",
  "num_classes": 7,
  "dropout_rate": 0.1,
  "freeze_backbone": false,
  "use_gradient_checkpointing": false,
  "batch_size": 32,
  "num_epochs": 30,
  "learning_rate": 5e-05,
  "weight_decay": 0.01,
  "warmup_steps": 500,
  "gradient_clip_norm": 1.0,
  "image_size": 224,
  "num_workers": 4,
  "val_split": 0.2,
  "use_augmented": true,
  "use_class_weights": true,
  "early_stopping_patience": 10,
  "early_stopping_min_delta": 0.001,
  "use_wandb": true,
  "wandb_project": "multimodal-fer"
}
2025-08-22 19:37:51,174 - INFO - Starting training for 30 epochs
2025-08-22 19:37:51,175 - INFO - 
=== Epoch 1/30 ===
2025-08-22 19:49:58,727 - INFO - Train - Loss: 1.5036, Acc: 0.4133, F1: 0.4073, Precision: 0.4090, Recall: 0.4133
2025-08-22 19:49:58,728 - INFO - Val   - Loss: 0.9754, Acc: 0.6033, F1: 0.5960, Precision: 0.6178, Recall: 0.6033
2025-08-22 19:50:01,011 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_thermal_20250822_193734/best_model.pth
2025-08-22 19:50:01,013 - INFO - New best model saved with F1: 0.5960
2025-08-22 19:50:01,015 - INFO - 
=== Epoch 2/30 ===
2025-08-22 19:54:38,877 - INFO - Train - Loss: 0.7165, Acc: 0.7089, F1: 0.7072, Precision: 0.7099, Recall: 0.7089
2025-08-22 19:54:38,878 - INFO - Val   - Loss: 0.5119, Acc: 0.7961, F1: 0.7936, Precision: 0.7989, Recall: 0.7961
2025-08-22 19:54:41,230 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_thermal_20250822_193734/best_model.pth
2025-08-22 19:54:41,231 - INFO - New best model saved with F1: 0.7936
2025-08-22 19:54:41,233 - INFO - 
=== Epoch 3/30 ===
2025-08-22 19:59:35,032 - INFO - Train - Loss: 0.4345, Acc: 0.8282, F1: 0.8281, Precision: 0.8287, Recall: 0.8282
2025-08-22 19:59:35,032 - INFO - Val   - Loss: 0.3413, Acc: 0.8657, F1: 0.8645, Precision: 0.8659, Recall: 0.8657
2025-08-22 19:59:37,748 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_thermal_20250822_193734/best_model.pth
2025-08-22 19:59:37,750 - INFO - New best model saved with F1: 0.8645
2025-08-22 19:59:39,569 - INFO - 
=== Epoch 4/30 ===
2025-08-22 20:04:31,500 - INFO - Train - Loss: 0.2949, Acc: 0.8852, F1: 0.8853, Precision: 0.8857, Recall: 0.8852
2025-08-22 20:04:31,501 - INFO - Val   - Loss: 0.2530, Acc: 0.9012, F1: 0.9012, Precision: 0.9019, Recall: 0.9012
2025-08-22 20:04:34,239 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_thermal_20250822_193734/best_model.pth
2025-08-22 20:04:34,241 - INFO - New best model saved with F1: 0.9012
2025-08-22 20:04:34,242 - INFO - 
=== Epoch 5/30 ===
2025-08-22 20:09:27,734 - INFO - Train - Loss: 0.2151, Acc: 0.9195, F1: 0.9196, Precision: 0.9197, Recall: 0.9195
2025-08-22 20:09:27,734 - INFO - Val   - Loss: 0.2195, Acc: 0.9162, F1: 0.9163, Precision: 0.9220, Recall: 0.9162
2025-08-22 20:09:30,130 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_thermal_20250822_193734/best_model.pth
2025-08-22 20:09:30,132 - INFO - New best model saved with F1: 0.9163
2025-08-22 20:09:30,133 - INFO - 
=== Epoch 6/30 ===
2025-08-22 20:14:23,842 - INFO - Train - Loss: 0.1723, Acc: 0.9339, F1: 0.9339, Precision: 0.9339, Recall: 0.9339
2025-08-22 20:14:23,842 - INFO - Val   - Loss: 0.1655, Acc: 0.9381, F1: 0.9381, Precision: 0.9396, Recall: 0.9381
2025-08-22 20:14:26,228 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_thermal_20250822_193734/best_model.pth
2025-08-22 20:14:26,230 - INFO - New best model saved with F1: 0.9381
2025-08-22 20:14:26,232 - INFO - 
=== Epoch 7/30 ===
2025-08-22 20:19:19,968 - INFO - Train - Loss: 0.1337, Acc: 0.9484, F1: 0.9485, Precision: 0.9485, Recall: 0.9484
2025-08-22 20:19:19,969 - INFO - Val   - Loss: 0.1340, Acc: 0.9456, F1: 0.9459, Precision: 0.9467, Recall: 0.9456
2025-08-22 20:19:22,395 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_thermal_20250822_193734/best_model.pth
2025-08-22 20:19:22,397 - INFO - New best model saved with F1: 0.9459
2025-08-22 20:19:24,399 - INFO - 
=== Epoch 8/30 ===
2025-08-22 20:24:16,481 - INFO - Train - Loss: 0.1087, Acc: 0.9598, F1: 0.9598, Precision: 0.9599, Recall: 0.9598
2025-08-22 20:24:16,481 - INFO - Val   - Loss: 0.1159, Acc: 0.9570, F1: 0.9569, Precision: 0.9572, Recall: 0.9570
2025-08-22 20:24:18,841 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_thermal_20250822_193734/best_model.pth
2025-08-22 20:24:18,843 - INFO - New best model saved with F1: 0.9569
2025-08-22 20:24:18,845 - INFO - 
=== Epoch 9/30 ===
2025-08-22 20:29:12,659 - INFO - Train - Loss: 0.0950, Acc: 0.9639, F1: 0.9639, Precision: 0.9639, Recall: 0.9639
2025-08-22 20:29:12,660 - INFO - Val   - Loss: 0.1063, Acc: 0.9580, F1: 0.9580, Precision: 0.9583, Recall: 0.9580
2025-08-22 20:29:15,053 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_thermal_20250822_193734/best_model.pth
2025-08-22 20:29:15,055 - INFO - New best model saved with F1: 0.9580
2025-08-22 20:29:15,056 - INFO - 
=== Epoch 10/30 ===
2025-08-22 20:34:09,243 - INFO - Train - Loss: 0.0825, Acc: 0.9709, F1: 0.9709, Precision: 0.9709, Recall: 0.9709
2025-08-22 20:34:09,244 - INFO - Val   - Loss: 0.1095, Acc: 0.9613, F1: 0.9614, Precision: 0.9622, Recall: 0.9613
2025-08-22 20:34:11,932 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_thermal_20250822_193734/best_model.pth
2025-08-22 20:34:11,934 - INFO - New best model saved with F1: 0.9614
2025-08-22 20:34:11,973 - INFO - 
=== Epoch 11/30 ===
2025-08-22 20:39:05,859 - INFO - Train - Loss: 0.0740, Acc: 0.9734, F1: 0.9734, Precision: 0.9735, Recall: 0.9734
2025-08-22 20:39:05,860 - INFO - Val   - Loss: 0.0843, Acc: 0.9720, F1: 0.9718, Precision: 0.9722, Recall: 0.9720
2025-08-22 20:39:10,119 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_thermal_20250822_193734/best_model.pth
2025-08-22 20:39:10,121 - INFO - New best model saved with F1: 0.9718
2025-08-22 20:39:10,122 - INFO - 
=== Epoch 12/30 ===
2025-08-22 20:44:02,252 - INFO - Train - Loss: 0.0639, Acc: 0.9768, F1: 0.9768, Precision: 0.9768, Recall: 0.9768
2025-08-22 20:44:02,253 - INFO - Val   - Loss: 0.0782, Acc: 0.9734, F1: 0.9733, Precision: 0.9736, Recall: 0.9734
2025-08-22 20:44:04,576 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_thermal_20250822_193734/best_model.pth
2025-08-22 20:44:04,578 - INFO - New best model saved with F1: 0.9733
2025-08-22 20:44:04,779 - INFO - 
=== Epoch 13/30 ===
2025-08-22 20:48:58,379 - INFO - Train - Loss: 0.0584, Acc: 0.9791, F1: 0.9791, Precision: 0.9791, Recall: 0.9791
2025-08-22 20:48:58,380 - INFO - Val   - Loss: 0.0727, Acc: 0.9766, F1: 0.9766, Precision: 0.9766, Recall: 0.9766
2025-08-22 20:49:00,785 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_thermal_20250822_193734/best_model.pth
2025-08-22 20:49:00,787 - INFO - New best model saved with F1: 0.9766
2025-08-22 20:49:00,789 - INFO - 
=== Epoch 14/30 ===
2025-08-22 20:53:55,015 - INFO - Train - Loss: 0.0514, Acc: 0.9819, F1: 0.9819, Precision: 0.9819, Recall: 0.9819
2025-08-22 20:53:55,016 - INFO - Val   - Loss: 0.0758, Acc: 0.9749, F1: 0.9750, Precision: 0.9754, Recall: 0.9749
2025-08-22 20:53:55,019 - INFO - 
=== Epoch 15/30 ===
2025-08-22 20:58:30,606 - INFO - Train - Loss: 0.0432, Acc: 0.9840, F1: 0.9840, Precision: 0.9840, Recall: 0.9840
2025-08-22 20:58:30,607 - INFO - Val   - Loss: 0.0549, Acc: 0.9809, F1: 0.9809, Precision: 0.9809, Recall: 0.9809
2025-08-22 20:58:33,013 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_thermal_20250822_193734/best_model.pth
2025-08-22 20:58:33,014 - INFO - New best model saved with F1: 0.9809
2025-08-22 20:58:33,017 - INFO - 
=== Epoch 16/30 ===
2025-08-22 21:03:26,646 - INFO - Train - Loss: 0.0373, Acc: 0.9853, F1: 0.9853, Precision: 0.9853, Recall: 0.9853
2025-08-22 21:03:26,647 - INFO - Val   - Loss: 0.0555, Acc: 0.9843, F1: 0.9843, Precision: 0.9843, Recall: 0.9843
2025-08-22 21:03:29,001 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_thermal_20250822_193734/best_model.pth
2025-08-22 21:03:29,003 - INFO - New best model saved with F1: 0.9843
2025-08-22 21:03:29,004 - INFO - 
=== Epoch 17/30 ===
2025-08-22 21:08:23,140 - INFO - Train - Loss: 0.0322, Acc: 0.9886, F1: 0.9886, Precision: 0.9886, Recall: 0.9886
2025-08-22 21:08:23,141 - INFO - Val   - Loss: 0.0570, Acc: 0.9819, F1: 0.9818, Precision: 0.9819, Recall: 0.9819
2025-08-22 21:08:23,143 - INFO - 
=== Epoch 18/30 ===
2025-08-22 21:12:58,750 - INFO - Train - Loss: 0.0318, Acc: 0.9883, F1: 0.9883, Precision: 0.9883, Recall: 0.9883
2025-08-22 21:12:58,751 - INFO - Val   - Loss: 0.0517, Acc: 0.9855, F1: 0.9855, Precision: 0.9856, Recall: 0.9855
2025-08-22 21:13:01,119 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_thermal_20250822_193734/best_model.pth
2025-08-22 21:13:01,120 - INFO - New best model saved with F1: 0.9855
2025-08-22 21:13:01,122 - INFO - 
=== Epoch 19/30 ===
2025-08-22 21:17:55,252 - INFO - Train - Loss: 0.0300, Acc: 0.9908, F1: 0.9908, Precision: 0.9908, Recall: 0.9908
2025-08-22 21:17:55,253 - INFO - Val   - Loss: 0.0467, Acc: 0.9850, F1: 0.9850, Precision: 0.9850, Recall: 0.9850
2025-08-22 21:17:55,256 - INFO - 
=== Epoch 20/30 ===
2025-08-22 21:22:31,018 - INFO - Train - Loss: 0.0236, Acc: 0.9917, F1: 0.9917, Precision: 0.9917, Recall: 0.9917
2025-08-22 21:22:31,019 - INFO - Val   - Loss: 0.0472, Acc: 0.9848, F1: 0.9848, Precision: 0.9848, Recall: 0.9848
2025-08-22 21:22:31,021 - INFO - 
=== Epoch 21/30 ===
2025-08-22 21:27:06,701 - INFO - Train - Loss: 0.0232, Acc: 0.9918, F1: 0.9918, Precision: 0.9918, Recall: 0.9918
2025-08-22 21:27:06,702 - INFO - Val   - Loss: 0.0474, Acc: 0.9843, F1: 0.9843, Precision: 0.9843, Recall: 0.9843
2025-08-22 21:27:06,704 - INFO - 
=== Epoch 22/30 ===
2025-08-22 21:31:42,377 - INFO - Train - Loss: 0.0231, Acc: 0.9918, F1: 0.9918, Precision: 0.9918, Recall: 0.9918
2025-08-22 21:31:42,378 - INFO - Val   - Loss: 0.0428, Acc: 0.9855, F1: 0.9855, Precision: 0.9855, Recall: 0.9855
2025-08-22 21:31:42,379 - INFO - 
=== Epoch 23/30 ===
2025-08-22 21:36:17,884 - INFO - Train - Loss: 0.0198, Acc: 0.9929, F1: 0.9929, Precision: 0.9929, Recall: 0.9929
2025-08-22 21:36:17,885 - INFO - Val   - Loss: 0.0420, Acc: 0.9853, F1: 0.9853, Precision: 0.9853, Recall: 0.9853
2025-08-22 21:36:17,887 - INFO - 
=== Epoch 24/30 ===
2025-08-22 21:40:53,478 - INFO - Train - Loss: 0.0196, Acc: 0.9938, F1: 0.9938, Precision: 0.9938, Recall: 0.9938
2025-08-22 21:40:53,479 - INFO - Val   - Loss: 0.0431, Acc: 0.9848, F1: 0.9848, Precision: 0.9848, Recall: 0.9848
2025-08-22 21:40:53,481 - INFO - 
=== Epoch 25/30 ===
2025-08-22 21:45:28,981 - INFO - Train - Loss: 0.0216, Acc: 0.9924, F1: 0.9924, Precision: 0.9924, Recall: 0.9924
2025-08-22 21:45:28,982 - INFO - Val   - Loss: 0.0395, Acc: 0.9870, F1: 0.9869, Precision: 0.9870, Recall: 0.9870
2025-08-22 21:45:31,364 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_thermal_20250822_193734/best_model.pth
2025-08-22 21:45:31,365 - INFO - New best model saved with F1: 0.9869
2025-08-22 21:45:31,366 - INFO - 
=== Epoch 26/30 ===
2025-08-22 21:50:25,122 - INFO - Train - Loss: 0.0158, Acc: 0.9944, F1: 0.9944, Precision: 0.9944, Recall: 0.9944
2025-08-22 21:50:25,123 - INFO - Val   - Loss: 0.0410, Acc: 0.9867, F1: 0.9867, Precision: 0.9867, Recall: 0.9867
2025-08-22 21:50:25,125 - INFO - 
=== Epoch 27/30 ===
2025-08-22 21:55:00,563 - INFO - Train - Loss: 0.0165, Acc: 0.9935, F1: 0.9935, Precision: 0.9935, Recall: 0.9935
2025-08-22 21:55:00,564 - INFO - Val   - Loss: 0.0395, Acc: 0.9865, F1: 0.9865, Precision: 0.9865, Recall: 0.9865
2025-08-22 21:55:00,567 - INFO - 
=== Epoch 28/30 ===
2025-08-22 21:59:36,015 - INFO - Train - Loss: 0.0168, Acc: 0.9943, F1: 0.9943, Precision: 0.9943, Recall: 0.9943
2025-08-22 21:59:36,016 - INFO - Val   - Loss: 0.0394, Acc: 0.9870, F1: 0.9870, Precision: 0.9870, Recall: 0.9870
2025-08-22 21:59:39,376 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_thermal_20250822_193734/best_model.pth
2025-08-22 21:59:39,378 - INFO - New best model saved with F1: 0.9870
2025-08-22 21:59:39,441 - INFO - 
=== Epoch 29/30 ===
2025-08-22 22:04:32,576 - INFO - Train - Loss: 0.0146, Acc: 0.9948, F1: 0.9948, Precision: 0.9948, Recall: 0.9948
2025-08-22 22:04:32,577 - INFO - Val   - Loss: 0.0390, Acc: 0.9879, F1: 0.9879, Precision: 0.9879, Recall: 0.9879
2025-08-22 22:04:35,316 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_thermal_20250822_193734/best_model.pth
2025-08-22 22:04:35,317 - INFO - New best model saved with F1: 0.9879
2025-08-22 22:04:35,318 - INFO - 
=== Epoch 30/30 ===
