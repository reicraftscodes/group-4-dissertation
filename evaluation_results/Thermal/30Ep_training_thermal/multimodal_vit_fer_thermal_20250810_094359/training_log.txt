2025-08-10 09:44:00,522 - INFO - Class weights: tensor([0.7590, 2.6634, 1.6918, 0.4908, 5.9129, 0.6691, 0.9855],
       device='cuda:0')
2025-08-10 09:44:00,565 - INFO - Trainer initialized. Experiment: multimodal_vit_fer_thermal_20250810_094359
2025-08-10 09:44:00,566 - INFO - Save directory: ./experiments/multimodal_vit_fer_thermal_20250810_094359
2025-08-10 09:44:00,567 - INFO - Training mode: thermal
2025-08-10 09:44:00,567 - INFO - Training samples: 16,556
2025-08-10 09:44:00,568 - INFO - Test samples: 4,139
2025-08-10 09:44:00,569 - INFO - Use augmented data: True
2025-08-10 09:44:00,569 - INFO - Training configuration: {
  "data_dir": "Data",
  "output_dir": "./experiments",
  "mode": "thermal",
  "fusion_strategy": "",
  "fusion_type": "",
  "fusion_layer": "",
  "model_name": "google/vit-base-patch16-224-in21k",
  "num_classes": 7,
  "dropout_rate": 0.1,
  "freeze_backbone": false,
  "use_gradient_checkpointing": false,
  "batch_size": 32,
  "num_epochs": 30,
  "learning_rate": 5e-05,
  "weight_decay": 0.01,
  "warmup_steps": 500,
  "gradient_clip_norm": 1.0,
  "image_size": 224,
  "num_workers": 4,
  "val_split": 0.2,
  "use_augmented": true,
  "use_class_weights": true,
  "early_stopping_patience": 10,
  "early_stopping_min_delta": 0.001,
  "use_wandb": false,
  "wandb_project": "multimodal-fer"
}
2025-08-10 09:44:00,570 - INFO - Starting training for 30 epochs
2025-08-10 09:44:00,570 - INFO - 
=== Epoch 1/30 ===
2025-08-10 10:06:06,086 - INFO - Train - Loss: 1.5340, Acc: 0.3960, F1: 0.3914, Precision: 0.3894, Recall: 0.3960
2025-08-10 10:06:06,087 - INFO - Val   - Loss: 1.0457, Acc: 0.5743, F1: 0.5617, Precision: 0.6038, Recall: 0.5743
2025-08-10 10:06:08,381 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_thermal_20250810_094359/best_model.pth
2025-08-10 10:06:08,383 - INFO - New best model saved with F1: 0.5617
2025-08-10 10:06:08,383 - INFO - 
=== Epoch 2/30 ===
2025-08-10 10:10:39,499 - INFO - Train - Loss: 0.7238, Acc: 0.7120, F1: 0.7105, Precision: 0.7138, Recall: 0.7120
2025-08-10 10:10:39,500 - INFO - Val   - Loss: 0.5228, Acc: 0.7862, F1: 0.7899, Precision: 0.7994, Recall: 0.7862
2025-08-10 10:10:41,818 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_thermal_20250810_094359/best_model.pth
2025-08-10 10:10:41,819 - INFO - New best model saved with F1: 0.7899
2025-08-10 10:10:41,820 - INFO - 
=== Epoch 3/30 ===
2025-08-10 10:15:28,919 - INFO - Train - Loss: 0.4284, Acc: 0.8335, F1: 0.8335, Precision: 0.8347, Recall: 0.8335
2025-08-10 10:15:28,920 - INFO - Val   - Loss: 0.3481, Acc: 0.8577, F1: 0.8559, Precision: 0.8630, Recall: 0.8577
2025-08-10 10:15:31,289 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_thermal_20250810_094359/best_model.pth
2025-08-10 10:15:31,291 - INFO - New best model saved with F1: 0.8559
2025-08-10 10:15:31,292 - INFO - 
=== Epoch 4/30 ===
2025-08-10 10:20:18,071 - INFO - Train - Loss: 0.2926, Acc: 0.8866, F1: 0.8866, Precision: 0.8868, Recall: 0.8866
2025-08-10 10:20:18,072 - INFO - Val   - Loss: 0.2380, Acc: 0.9094, F1: 0.9096, Precision: 0.9118, Recall: 0.9094
2025-08-10 10:20:20,466 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_thermal_20250810_094359/best_model.pth
2025-08-10 10:20:20,468 - INFO - New best model saved with F1: 0.9096
2025-08-10 10:20:20,468 - INFO - 
=== Epoch 5/30 ===
2025-08-10 10:25:07,862 - INFO - Train - Loss: 0.2130, Acc: 0.9199, F1: 0.9199, Precision: 0.9200, Recall: 0.9199
2025-08-10 10:25:07,863 - INFO - Val   - Loss: 0.1939, Acc: 0.9200, F1: 0.9213, Precision: 0.9256, Recall: 0.9200
2025-08-10 10:25:10,203 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_thermal_20250810_094359/best_model.pth
2025-08-10 10:25:10,205 - INFO - New best model saved with F1: 0.9213
2025-08-10 10:25:10,205 - INFO - 
=== Epoch 6/30 ===
2025-08-10 10:29:57,626 - INFO - Train - Loss: 0.1708, Acc: 0.9339, F1: 0.9339, Precision: 0.9340, Recall: 0.9339
2025-08-10 10:29:57,627 - INFO - Val   - Loss: 0.1636, Acc: 0.9360, F1: 0.9363, Precision: 0.9387, Recall: 0.9360
2025-08-10 10:30:00,403 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_thermal_20250810_094359/best_model.pth
2025-08-10 10:30:00,404 - INFO - New best model saved with F1: 0.9363
2025-08-10 10:30:00,405 - INFO - 
=== Epoch 7/30 ===
2025-08-10 10:34:47,929 - INFO - Train - Loss: 0.1357, Acc: 0.9490, F1: 0.9490, Precision: 0.9491, Recall: 0.9490
2025-08-10 10:34:47,929 - INFO - Val   - Loss: 0.1353, Acc: 0.9497, F1: 0.9497, Precision: 0.9500, Recall: 0.9497
2025-08-10 10:34:50,343 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_thermal_20250810_094359/best_model.pth
2025-08-10 10:34:50,344 - INFO - New best model saved with F1: 0.9497
2025-08-10 10:34:50,345 - INFO - 
=== Epoch 8/30 ===
2025-08-10 10:39:37,680 - INFO - Train - Loss: 0.1124, Acc: 0.9564, F1: 0.9564, Precision: 0.9564, Recall: 0.9564
2025-08-10 10:39:37,681 - INFO - Val   - Loss: 0.1116, Acc: 0.9548, F1: 0.9548, Precision: 0.9550, Recall: 0.9548
2025-08-10 10:39:40,052 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_thermal_20250810_094359/best_model.pth
2025-08-10 10:39:40,054 - INFO - New best model saved with F1: 0.9548
2025-08-10 10:39:40,055 - INFO - 
=== Epoch 9/30 ===
2025-08-10 10:44:27,360 - INFO - Train - Loss: 0.0993, Acc: 0.9629, F1: 0.9629, Precision: 0.9630, Recall: 0.9629
2025-08-10 10:44:27,361 - INFO - Val   - Loss: 0.1179, Acc: 0.9531, F1: 0.9536, Precision: 0.9557, Recall: 0.9531
2025-08-10 10:44:27,362 - INFO - 
=== Epoch 10/30 ===
2025-08-10 10:48:56,535 - INFO - Train - Loss: 0.0821, Acc: 0.9691, F1: 0.9690, Precision: 0.9691, Recall: 0.9691
2025-08-10 10:48:56,536 - INFO - Val   - Loss: 0.1116, Acc: 0.9606, F1: 0.9606, Precision: 0.9615, Recall: 0.9606
2025-08-10 10:48:58,916 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_thermal_20250810_094359/best_model.pth
2025-08-10 10:48:58,918 - INFO - New best model saved with F1: 0.9606
2025-08-10 10:48:58,919 - INFO - 
=== Epoch 11/30 ===
2025-08-10 10:53:46,531 - INFO - Train - Loss: 0.0720, Acc: 0.9717, F1: 0.9717, Precision: 0.9717, Recall: 0.9717
2025-08-10 10:53:46,532 - INFO - Val   - Loss: 0.1004, Acc: 0.9664, F1: 0.9665, Precision: 0.9672, Recall: 0.9664
2025-08-10 10:53:48,886 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_thermal_20250810_094359/best_model.pth
2025-08-10 10:53:48,887 - INFO - New best model saved with F1: 0.9665
2025-08-10 10:53:48,888 - INFO - 
=== Epoch 12/30 ===
2025-08-10 10:58:35,338 - INFO - Train - Loss: 0.0630, Acc: 0.9783, F1: 0.9783, Precision: 0.9783, Recall: 0.9783
2025-08-10 10:58:35,339 - INFO - Val   - Loss: 0.0799, Acc: 0.9712, F1: 0.9713, Precision: 0.9715, Recall: 0.9712
2025-08-10 10:58:37,709 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_thermal_20250810_094359/best_model.pth
2025-08-10 10:58:37,711 - INFO - New best model saved with F1: 0.9713
2025-08-10 10:58:37,711 - INFO - 
=== Epoch 13/30 ===
2025-08-10 11:03:24,616 - INFO - Train - Loss: 0.0566, Acc: 0.9790, F1: 0.9790, Precision: 0.9790, Recall: 0.9790
2025-08-10 11:03:24,616 - INFO - Val   - Loss: 0.0710, Acc: 0.9768, F1: 0.9768, Precision: 0.9771, Recall: 0.9768
2025-08-10 11:03:26,979 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_thermal_20250810_094359/best_model.pth
2025-08-10 11:03:26,981 - INFO - New best model saved with F1: 0.9768
2025-08-10 11:03:26,981 - INFO - 
=== Epoch 14/30 ===
2025-08-10 11:08:13,815 - INFO - Train - Loss: 0.0515, Acc: 0.9813, F1: 0.9813, Precision: 0.9813, Recall: 0.9813
2025-08-10 11:08:13,815 - INFO - Val   - Loss: 0.0839, Acc: 0.9744, F1: 0.9744, Precision: 0.9755, Recall: 0.9744
2025-08-10 11:08:13,816 - INFO - 
=== Epoch 15/30 ===
2025-08-10 11:12:42,923 - INFO - Train - Loss: 0.0457, Acc: 0.9827, F1: 0.9827, Precision: 0.9827, Recall: 0.9827
2025-08-10 11:12:42,924 - INFO - Val   - Loss: 0.0609, Acc: 0.9775, F1: 0.9775, Precision: 0.9780, Recall: 0.9775
2025-08-10 11:12:45,276 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_thermal_20250810_094359/best_model.pth
2025-08-10 11:12:45,277 - INFO - New best model saved with F1: 0.9775
2025-08-10 11:12:45,278 - INFO - 
=== Epoch 16/30 ===
2025-08-10 11:17:31,866 - INFO - Train - Loss: 0.0380, Acc: 0.9860, F1: 0.9860, Precision: 0.9860, Recall: 0.9860
2025-08-10 11:17:31,867 - INFO - Val   - Loss: 0.0573, Acc: 0.9792, F1: 0.9792, Precision: 0.9794, Recall: 0.9792
2025-08-10 11:17:34,223 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_thermal_20250810_094359/best_model.pth
2025-08-10 11:17:34,225 - INFO - New best model saved with F1: 0.9792
2025-08-10 11:17:34,225 - INFO - 
=== Epoch 17/30 ===
2025-08-10 11:22:20,692 - INFO - Train - Loss: 0.0372, Acc: 0.9872, F1: 0.9872, Precision: 0.9872, Recall: 0.9872
2025-08-10 11:22:20,693 - INFO - Val   - Loss: 0.0627, Acc: 0.9812, F1: 0.9812, Precision: 0.9814, Recall: 0.9812
2025-08-10 11:22:23,042 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_thermal_20250810_094359/best_model.pth
2025-08-10 11:22:23,043 - INFO - New best model saved with F1: 0.9812
2025-08-10 11:22:23,044 - INFO - 
=== Epoch 18/30 ===
2025-08-10 11:27:09,563 - INFO - Train - Loss: 0.0313, Acc: 0.9890, F1: 0.9890, Precision: 0.9890, Recall: 0.9890
2025-08-10 11:27:09,564 - INFO - Val   - Loss: 0.0568, Acc: 0.9821, F1: 0.9821, Precision: 0.9823, Recall: 0.9821
2025-08-10 11:27:11,939 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_thermal_20250810_094359/best_model.pth
2025-08-10 11:27:11,940 - INFO - New best model saved with F1: 0.9821
2025-08-10 11:27:11,941 - INFO - 
=== Epoch 19/30 ===
2025-08-10 11:31:58,871 - INFO - Train - Loss: 0.0302, Acc: 0.9893, F1: 0.9893, Precision: 0.9893, Recall: 0.9893
2025-08-10 11:31:58,872 - INFO - Val   - Loss: 0.0460, Acc: 0.9857, F1: 0.9858, Precision: 0.9858, Recall: 0.9857
2025-08-10 11:32:01,322 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_thermal_20250810_094359/best_model.pth
2025-08-10 11:32:01,324 - INFO - New best model saved with F1: 0.9858
2025-08-10 11:32:01,324 - INFO - 
=== Epoch 20/30 ===
2025-08-10 11:36:48,377 - INFO - Train - Loss: 0.0295, Acc: 0.9898, F1: 0.9898, Precision: 0.9899, Recall: 0.9898
2025-08-10 11:36:48,378 - INFO - Val   - Loss: 0.0470, Acc: 0.9862, F1: 0.9862, Precision: 0.9863, Recall: 0.9862
2025-08-10 11:36:50,757 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_thermal_20250810_094359/best_model.pth
2025-08-10 11:36:50,758 - INFO - New best model saved with F1: 0.9862
2025-08-10 11:36:50,759 - INFO - 
=== Epoch 21/30 ===
2025-08-10 11:41:37,463 - INFO - Train - Loss: 0.0249, Acc: 0.9913, F1: 0.9913, Precision: 0.9913, Recall: 0.9913
2025-08-10 11:41:37,463 - INFO - Val   - Loss: 0.0435, Acc: 0.9867, F1: 0.9867, Precision: 0.9867, Recall: 0.9867
2025-08-10 11:41:39,823 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_thermal_20250810_094359/best_model.pth
2025-08-10 11:41:39,824 - INFO - New best model saved with F1: 0.9867
2025-08-10 11:41:39,825 - INFO - 
=== Epoch 22/30 ===
2025-08-10 11:46:26,602 - INFO - Train - Loss: 0.0244, Acc: 0.9921, F1: 0.9921, Precision: 0.9921, Recall: 0.9921
2025-08-10 11:46:26,603 - INFO - Val   - Loss: 0.0426, Acc: 0.9882, F1: 0.9882, Precision: 0.9882, Recall: 0.9882
2025-08-10 11:46:28,974 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_thermal_20250810_094359/best_model.pth
2025-08-10 11:46:28,976 - INFO - New best model saved with F1: 0.9882
2025-08-10 11:46:28,976 - INFO - 
=== Epoch 23/30 ===
2025-08-10 11:51:16,094 - INFO - Train - Loss: 0.0249, Acc: 0.9917, F1: 0.9917, Precision: 0.9917, Recall: 0.9917
2025-08-10 11:51:16,095 - INFO - Val   - Loss: 0.0407, Acc: 0.9889, F1: 0.9889, Precision: 0.9889, Recall: 0.9889
2025-08-10 11:51:18,460 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_thermal_20250810_094359/best_model.pth
2025-08-10 11:51:18,462 - INFO - New best model saved with F1: 0.9889
2025-08-10 11:51:18,462 - INFO - 
=== Epoch 24/30 ===
2025-08-10 11:56:05,564 - INFO - Train - Loss: 0.0195, Acc: 0.9933, F1: 0.9933, Precision: 0.9933, Recall: 0.9933
2025-08-10 11:56:05,565 - INFO - Val   - Loss: 0.0404, Acc: 0.9894, F1: 0.9894, Precision: 0.9894, Recall: 0.9894
2025-08-10 11:56:07,929 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_thermal_20250810_094359/best_model.pth
2025-08-10 11:56:07,931 - INFO - New best model saved with F1: 0.9894
2025-08-10 11:56:07,931 - INFO - 
=== Epoch 25/30 ===
2025-08-10 12:00:54,631 - INFO - Train - Loss: 0.0209, Acc: 0.9930, F1: 0.9930, Precision: 0.9931, Recall: 0.9930
2025-08-10 12:00:54,632 - INFO - Val   - Loss: 0.0388, Acc: 0.9891, F1: 0.9891, Precision: 0.9891, Recall: 0.9891
2025-08-10 12:00:54,633 - INFO - 
=== Epoch 26/30 ===
2025-08-10 12:05:23,659 - INFO - Train - Loss: 0.0171, Acc: 0.9938, F1: 0.9938, Precision: 0.9938, Recall: 0.9938
2025-08-10 12:05:23,659 - INFO - Val   - Loss: 0.0418, Acc: 0.9889, F1: 0.9889, Precision: 0.9890, Recall: 0.9889
2025-08-10 12:05:23,661 - INFO - 
=== Epoch 27/30 ===
2025-08-10 12:09:52,609 - INFO - Train - Loss: 0.0139, Acc: 0.9949, F1: 0.9949, Precision: 0.9949, Recall: 0.9949
2025-08-10 12:09:52,610 - INFO - Val   - Loss: 0.0392, Acc: 0.9891, F1: 0.9891, Precision: 0.9892, Recall: 0.9891
2025-08-10 12:09:52,611 - INFO - 
=== Epoch 28/30 ===
2025-08-10 12:14:21,463 - INFO - Train - Loss: 0.0184, Acc: 0.9941, F1: 0.9941, Precision: 0.9941, Recall: 0.9941
2025-08-10 12:14:21,464 - INFO - Val   - Loss: 0.0387, Acc: 0.9896, F1: 0.9896, Precision: 0.9897, Recall: 0.9896
2025-08-10 12:14:23,842 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_thermal_20250810_094359/best_model.pth
2025-08-10 12:14:23,844 - INFO - New best model saved with F1: 0.9896
2025-08-10 12:14:23,844 - INFO - 
=== Epoch 29/30 ===
2025-08-10 12:19:10,787 - INFO - Train - Loss: 0.0182, Acc: 0.9934, F1: 0.9934, Precision: 0.9934, Recall: 0.9934
2025-08-10 12:19:10,787 - INFO - Val   - Loss: 0.0378, Acc: 0.9894, F1: 0.9894, Precision: 0.9894, Recall: 0.9894
2025-08-10 12:19:10,788 - INFO - 
=== Epoch 30/30 ===
2025-08-10 12:23:39,632 - INFO - Train - Loss: 0.0146, Acc: 0.9950, F1: 0.9950, Precision: 0.9950, Recall: 0.9950
2025-08-10 12:23:39,633 - INFO - Val   - Loss: 0.0377, Acc: 0.9891, F1: 0.9891, Precision: 0.9892, Recall: 0.9891
2025-08-10 12:23:41,851 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_thermal_20250810_094359/last_model.pth
2025-08-10 12:23:45,769 - INFO - === DETAILED EVALUATION RESULTS ===
2025-08-10 12:23:45,770 - INFO - Overall Accuracy: 0.9891
2025-08-10 12:23:45,771 - INFO - Macro F1-Score: 0.9918
2025-08-10 12:23:45,771 - INFO - Micro F1-Score: 0.9891
2025-08-10 12:23:45,772 - INFO - Weighted F1-Score: 0.9891
2025-08-10 12:23:45,773 - INFO - Per-class Accuracy:
2025-08-10 12:23:45,774 - INFO -   angry: 0.9962
2025-08-10 12:23:45,775 - INFO -   disgust: 1.0000
2025-08-10 12:23:45,775 - INFO -   fear: 0.9970
2025-08-10 12:23:45,776 - INFO -   happy: 0.9794
2025-08-10 12:23:45,777 - INFO -   neutral: 0.9913
2025-08-10 12:23:45,777 - INFO -   sad: 0.9977
2025-08-10 12:23:45,778 - INFO -   surprised: 0.9783
2025-08-10 12:23:45,779 - INFO - Final evaluation completed with comprehensive metrics
2025-08-10 12:23:45,788 - INFO - Training completed!
