2025-08-09 15:20:08,388 - INFO - Class weights: tensor([0.6980, 2.5104, 1.6030, 0.4961, 5.3240, 0.6828, 1.1403],
       device='cuda:0')
2025-08-09 15:20:08,432 - INFO - Trainer initialized. Experiment: multimodal_vit_fer_rgb_20250809_152007
2025-08-09 15:20:08,432 - INFO - Save directory: ./experiments/multimodal_vit_fer_rgb_20250809_152007
2025-08-09 15:20:08,433 - INFO - Training mode: rgb
2025-08-09 15:20:08,434 - INFO - Training samples: 15,429
2025-08-09 15:20:08,434 - INFO - Test samples: 3,858
2025-08-09 15:20:08,435 - INFO - Use augmented data: True
2025-08-09 15:20:08,436 - INFO - Training configuration: {
  "data_dir": "Data",
  "output_dir": "./experiments",
  "mode": "rgb",
  "fusion_strategy": "",
  "fusion_type": "",
  "fusion_layer": "",
  "model_name": "google/vit-base-patch16-224-in21k",
  "num_classes": 7,
  "dropout_rate": 0.1,
  "freeze_backbone": false,
  "use_gradient_checkpointing": false,
  "batch_size": 32,
  "num_epochs": 30,
  "learning_rate": 5e-05,
  "weight_decay": 0.01,
  "warmup_steps": 500,
  "gradient_clip_norm": 1.0,
  "image_size": 224,
  "num_workers": 4,
  "val_split": 0.2,
  "use_augmented": true,
  "use_class_weights": true,
  "early_stopping_patience": 10,
  "early_stopping_min_delta": 0.001,
  "use_wandb": false,
  "wandb_project": "multimodal-fer"
}
2025-08-09 15:20:08,437 - INFO - Starting training for 30 epochs
2025-08-09 15:20:08,437 - INFO - 
=== Epoch 1/30 ===
2025-08-09 16:15:22,641 - INFO - Train - Loss: 1.6615, Acc: 0.3550, F1: 0.3455, Precision: 0.3496, Recall: 0.3550
2025-08-09 16:15:22,642 - INFO - Val   - Loss: 1.1463, Acc: 0.5713, F1: 0.5522, Precision: 0.5796, Recall: 0.5713
2025-08-09 16:15:25,018 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_rgb_20250809_152007/best_model.pth
2025-08-09 16:15:25,019 - INFO - New best model saved with F1: 0.5522
2025-08-09 16:15:25,020 - INFO - 
=== Epoch 2/30 ===
2025-08-09 16:19:35,030 - INFO - Train - Loss: 0.9469, Acc: 0.6394, F1: 0.6350, Precision: 0.6426, Recall: 0.6394
2025-08-09 16:19:35,031 - INFO - Val   - Loss: 0.7201, Acc: 0.7351, F1: 0.7315, Precision: 0.7382, Recall: 0.7351
2025-08-09 16:19:37,537 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_rgb_20250809_152007/best_model.pth
2025-08-09 16:19:37,538 - INFO - New best model saved with F1: 0.7315
2025-08-09 16:19:37,539 - INFO - 
=== Epoch 3/30 ===
2025-08-09 16:24:11,091 - INFO - Train - Loss: 0.6655, Acc: 0.7529, F1: 0.7512, Precision: 0.7534, Recall: 0.7529
2025-08-09 16:24:11,092 - INFO - Val   - Loss: 0.5433, Acc: 0.7996, F1: 0.7981, Precision: 0.8160, Recall: 0.7996
2025-08-09 16:24:13,554 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_rgb_20250809_152007/best_model.pth
2025-08-09 16:24:13,556 - INFO - New best model saved with F1: 0.7981
2025-08-09 16:24:13,557 - INFO - 
=== Epoch 4/30 ===
2025-08-09 16:28:47,493 - INFO - Train - Loss: 0.5106, Acc: 0.8126, F1: 0.8116, Precision: 0.8126, Recall: 0.8126
2025-08-09 16:28:47,494 - INFO - Val   - Loss: 0.4243, Acc: 0.8510, F1: 0.8503, Precision: 0.8525, Recall: 0.8510
2025-08-09 16:28:49,906 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_rgb_20250809_152007/best_model.pth
2025-08-09 16:28:49,908 - INFO - New best model saved with F1: 0.8503
2025-08-09 16:28:49,909 - INFO - 
=== Epoch 5/30 ===
2025-08-09 16:33:23,644 - INFO - Train - Loss: 0.4066, Acc: 0.8512, F1: 0.8506, Precision: 0.8509, Recall: 0.8512
2025-08-09 16:33:23,645 - INFO - Val   - Loss: 0.3550, Acc: 0.8795, F1: 0.8776, Precision: 0.8842, Recall: 0.8795
2025-08-09 16:33:26,030 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_rgb_20250809_152007/best_model.pth
2025-08-09 16:33:26,031 - INFO - New best model saved with F1: 0.8776
2025-08-09 16:33:26,032 - INFO - 
=== Epoch 6/30 ===
2025-08-09 16:37:59,967 - INFO - Train - Loss: 0.3358, Acc: 0.8797, F1: 0.8794, Precision: 0.8796, Recall: 0.8797
2025-08-09 16:37:59,968 - INFO - Val   - Loss: 0.3586, Acc: 0.8709, F1: 0.8686, Precision: 0.8779, Recall: 0.8709
2025-08-09 16:37:59,969 - INFO - 
=== Epoch 7/30 ===
2025-08-09 16:42:15,003 - INFO - Train - Loss: 0.2846, Acc: 0.8954, F1: 0.8950, Precision: 0.8952, Recall: 0.8954
2025-08-09 16:42:15,004 - INFO - Val   - Loss: 0.2718, Acc: 0.9025, F1: 0.9021, Precision: 0.9050, Recall: 0.9025
2025-08-09 16:42:17,884 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_rgb_20250809_152007/best_model.pth
2025-08-09 16:42:17,886 - INFO - New best model saved with F1: 0.9021
2025-08-09 16:42:17,886 - INFO - 
=== Epoch 8/30 ===
2025-08-09 16:46:52,189 - INFO - Train - Loss: 0.2398, Acc: 0.9147, F1: 0.9145, Precision: 0.9145, Recall: 0.9147
2025-08-09 16:46:52,190 - INFO - Val   - Loss: 0.2176, Acc: 0.9233, F1: 0.9231, Precision: 0.9264, Recall: 0.9233
2025-08-09 16:46:54,672 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_rgb_20250809_152007/best_model.pth
2025-08-09 16:46:54,673 - INFO - New best model saved with F1: 0.9231
2025-08-09 16:46:54,674 - INFO - 
=== Epoch 9/30 ===
2025-08-09 16:51:28,670 - INFO - Train - Loss: 0.2153, Acc: 0.9219, F1: 0.9217, Precision: 0.9218, Recall: 0.9219
2025-08-09 16:51:28,671 - INFO - Val   - Loss: 0.1837, Acc: 0.9368, F1: 0.9364, Precision: 0.9369, Recall: 0.9368
2025-08-09 16:51:32,951 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_rgb_20250809_152007/best_model.pth
2025-08-09 16:51:32,953 - INFO - New best model saved with F1: 0.9364
2025-08-09 16:51:32,954 - INFO - 
=== Epoch 10/30 ===
2025-08-09 16:56:05,511 - INFO - Train - Loss: 0.1863, Acc: 0.9338, F1: 0.9336, Precision: 0.9337, Recall: 0.9338
2025-08-09 16:56:05,512 - INFO - Val   - Loss: 0.1747, Acc: 0.9386, F1: 0.9382, Precision: 0.9395, Recall: 0.9386
2025-08-09 16:56:07,980 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_rgb_20250809_152007/best_model.pth
2025-08-09 16:56:07,981 - INFO - New best model saved with F1: 0.9382
2025-08-09 16:56:07,982 - INFO - 
=== Epoch 11/30 ===
2025-08-09 17:00:42,032 - INFO - Train - Loss: 0.1728, Acc: 0.9381, F1: 0.9379, Precision: 0.9379, Recall: 0.9381
2025-08-09 17:00:42,033 - INFO - Val   - Loss: 0.1633, Acc: 0.9474, F1: 0.9472, Precision: 0.9479, Recall: 0.9474
2025-08-09 17:00:44,454 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_rgb_20250809_152007/best_model.pth
2025-08-09 17:00:44,455 - INFO - New best model saved with F1: 0.9472
2025-08-09 17:00:44,456 - INFO - 
=== Epoch 12/30 ===
2025-08-09 17:05:18,263 - INFO - Train - Loss: 0.1563, Acc: 0.9457, F1: 0.9456, Precision: 0.9456, Recall: 0.9457
2025-08-09 17:05:18,264 - INFO - Val   - Loss: 0.1627, Acc: 0.9427, F1: 0.9425, Precision: 0.9438, Recall: 0.9427
2025-08-09 17:05:18,265 - INFO - 
=== Epoch 13/30 ===
2025-08-09 17:09:33,159 - INFO - Train - Loss: 0.1439, Acc: 0.9499, F1: 0.9499, Precision: 0.9499, Recall: 0.9499
2025-08-09 17:09:33,160 - INFO - Val   - Loss: 0.1574, Acc: 0.9463, F1: 0.9462, Precision: 0.9476, Recall: 0.9463
2025-08-09 17:09:33,161 - INFO - 
=== Epoch 14/30 ===
2025-08-09 17:13:47,961 - INFO - Train - Loss: 0.1273, Acc: 0.9542, F1: 0.9542, Precision: 0.9542, Recall: 0.9542
2025-08-09 17:13:47,962 - INFO - Val   - Loss: 0.1245, Acc: 0.9572, F1: 0.9571, Precision: 0.9574, Recall: 0.9572
2025-08-09 17:13:50,461 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_rgb_20250809_152007/best_model.pth
2025-08-09 17:13:50,463 - INFO - New best model saved with F1: 0.9571
2025-08-09 17:13:50,463 - INFO - 
=== Epoch 15/30 ===
2025-08-09 17:18:24,032 - INFO - Train - Loss: 0.1165, Acc: 0.9597, F1: 0.9596, Precision: 0.9596, Recall: 0.9597
2025-08-09 17:18:24,033 - INFO - Val   - Loss: 0.1107, Acc: 0.9647, F1: 0.9647, Precision: 0.9651, Recall: 0.9647
2025-08-09 17:18:26,473 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_rgb_20250809_152007/best_model.pth
2025-08-09 17:18:26,474 - INFO - New best model saved with F1: 0.9647
2025-08-09 17:18:26,474 - INFO - 
=== Epoch 16/30 ===
2025-08-09 17:23:00,258 - INFO - Train - Loss: 0.1105, Acc: 0.9616, F1: 0.9615, Precision: 0.9616, Recall: 0.9616
2025-08-09 17:23:00,259 - INFO - Val   - Loss: 0.1072, Acc: 0.9658, F1: 0.9658, Precision: 0.9659, Recall: 0.9658
2025-08-09 17:23:02,704 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_rgb_20250809_152007/best_model.pth
2025-08-09 17:23:02,705 - INFO - New best model saved with F1: 0.9658
2025-08-09 17:23:02,706 - INFO - 
=== Epoch 17/30 ===
2025-08-09 17:27:36,837 - INFO - Train - Loss: 0.1026, Acc: 0.9636, F1: 0.9636, Precision: 0.9637, Recall: 0.9636
2025-08-09 17:27:36,838 - INFO - Val   - Loss: 0.1096, Acc: 0.9611, F1: 0.9610, Precision: 0.9615, Recall: 0.9611
2025-08-09 17:27:36,839 - INFO - 
=== Epoch 18/30 ===
2025-08-09 17:31:51,609 - INFO - Train - Loss: 0.0909, Acc: 0.9681, F1: 0.9680, Precision: 0.9680, Recall: 0.9681
2025-08-09 17:31:51,610 - INFO - Val   - Loss: 0.0967, Acc: 0.9663, F1: 0.9662, Precision: 0.9665, Recall: 0.9663
2025-08-09 17:31:54,058 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_rgb_20250809_152007/best_model.pth
2025-08-09 17:31:54,059 - INFO - New best model saved with F1: 0.9662
2025-08-09 17:31:54,060 - INFO - 
=== Epoch 19/30 ===
2025-08-09 17:36:27,809 - INFO - Train - Loss: 0.0889, Acc: 0.9704, F1: 0.9703, Precision: 0.9703, Recall: 0.9704
2025-08-09 17:36:27,810 - INFO - Val   - Loss: 0.0980, Acc: 0.9660, F1: 0.9660, Precision: 0.9667, Recall: 0.9660
2025-08-09 17:36:27,811 - INFO - 
=== Epoch 20/30 ===
2025-08-09 17:40:42,607 - INFO - Train - Loss: 0.0830, Acc: 0.9702, F1: 0.9702, Precision: 0.9702, Recall: 0.9702
2025-08-09 17:40:42,608 - INFO - Val   - Loss: 0.0921, Acc: 0.9686, F1: 0.9686, Precision: 0.9691, Recall: 0.9686
2025-08-09 17:40:45,101 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_rgb_20250809_152007/best_model.pth
2025-08-09 17:40:45,102 - INFO - New best model saved with F1: 0.9686
2025-08-09 17:40:45,103 - INFO - 
=== Epoch 21/30 ===
2025-08-09 17:45:19,133 - INFO - Train - Loss: 0.0821, Acc: 0.9713, F1: 0.9713, Precision: 0.9713, Recall: 0.9713
2025-08-09 17:45:19,134 - INFO - Val   - Loss: 0.0874, Acc: 0.9697, F1: 0.9696, Precision: 0.9699, Recall: 0.9697
2025-08-09 17:45:21,586 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_rgb_20250809_152007/best_model.pth
2025-08-09 17:45:21,588 - INFO - New best model saved with F1: 0.9696
2025-08-09 17:45:21,589 - INFO - 
=== Epoch 22/30 ===
2025-08-09 17:49:55,589 - INFO - Train - Loss: 0.0736, Acc: 0.9745, F1: 0.9745, Precision: 0.9745, Recall: 0.9745
2025-08-09 17:49:55,590 - INFO - Val   - Loss: 0.0937, Acc: 0.9712, F1: 0.9712, Precision: 0.9716, Recall: 0.9712
2025-08-09 17:49:58,093 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_rgb_20250809_152007/best_model.pth
2025-08-09 17:49:58,095 - INFO - New best model saved with F1: 0.9712
2025-08-09 17:49:58,096 - INFO - 
=== Epoch 23/30 ===
2025-08-09 17:54:31,873 - INFO - Train - Loss: 0.0701, Acc: 0.9756, F1: 0.9755, Precision: 0.9756, Recall: 0.9756
2025-08-09 17:54:31,874 - INFO - Val   - Loss: 0.0898, Acc: 0.9694, F1: 0.9694, Precision: 0.9699, Recall: 0.9694
2025-08-09 17:54:31,875 - INFO - 
=== Epoch 24/30 ===
2025-08-09 17:58:46,824 - INFO - Train - Loss: 0.0709, Acc: 0.9748, F1: 0.9748, Precision: 0.9748, Recall: 0.9748
2025-08-09 17:58:46,825 - INFO - Val   - Loss: 0.0842, Acc: 0.9712, F1: 0.9712, Precision: 0.9717, Recall: 0.9712
2025-08-09 17:58:46,826 - INFO - 
=== Epoch 25/30 ===
2025-08-09 18:03:01,719 - INFO - Train - Loss: 0.0685, Acc: 0.9764, F1: 0.9764, Precision: 0.9764, Recall: 0.9764
2025-08-09 18:03:01,720 - INFO - Val   - Loss: 0.0866, Acc: 0.9725, F1: 0.9725, Precision: 0.9730, Recall: 0.9725
2025-08-09 18:03:04,227 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_rgb_20250809_152007/best_model.pth
2025-08-09 18:03:04,229 - INFO - New best model saved with F1: 0.9725
2025-08-09 18:03:04,229 - INFO - 
=== Epoch 26/30 ===
2025-08-09 18:07:37,696 - INFO - Train - Loss: 0.0622, Acc: 0.9790, F1: 0.9790, Precision: 0.9790, Recall: 0.9790
2025-08-09 18:07:37,697 - INFO - Val   - Loss: 0.0847, Acc: 0.9736, F1: 0.9736, Precision: 0.9739, Recall: 0.9736
2025-08-09 18:07:40,151 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_rgb_20250809_152007/best_model.pth
2025-08-09 18:07:40,152 - INFO - New best model saved with F1: 0.9736
2025-08-09 18:07:40,153 - INFO - 
=== Epoch 27/30 ===
2025-08-09 18:12:13,864 - INFO - Train - Loss: 0.0623, Acc: 0.9789, F1: 0.9788, Precision: 0.9788, Recall: 0.9789
2025-08-09 18:12:13,865 - INFO - Val   - Loss: 0.0825, Acc: 0.9723, F1: 0.9723, Precision: 0.9726, Recall: 0.9723
2025-08-09 18:12:13,866 - INFO - 
=== Epoch 28/30 ===
2025-08-09 18:16:28,633 - INFO - Train - Loss: 0.0642, Acc: 0.9779, F1: 0.9779, Precision: 0.9779, Recall: 0.9779
2025-08-09 18:16:28,634 - INFO - Val   - Loss: 0.0833, Acc: 0.9720, F1: 0.9720, Precision: 0.9723, Recall: 0.9720
2025-08-09 18:16:28,635 - INFO - 
=== Epoch 29/30 ===
2025-08-09 18:20:43,546 - INFO - Train - Loss: 0.0624, Acc: 0.9794, F1: 0.9794, Precision: 0.9794, Recall: 0.9794
2025-08-09 18:20:43,547 - INFO - Val   - Loss: 0.0828, Acc: 0.9728, F1: 0.9728, Precision: 0.9731, Recall: 0.9728
2025-08-09 18:20:43,549 - INFO - 
=== Epoch 30/30 ===
2025-08-09 18:24:58,371 - INFO - Train - Loss: 0.0600, Acc: 0.9805, F1: 0.9805, Precision: 0.9805, Recall: 0.9805
2025-08-09 18:24:58,372 - INFO - Val   - Loss: 0.0826, Acc: 0.9728, F1: 0.9728, Precision: 0.9731, Recall: 0.9728
2025-08-09 18:25:00,687 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_rgb_20250809_152007/last_model.pth
2025-08-09 18:25:04,624 - INFO - === DETAILED EVALUATION RESULTS ===
2025-08-09 18:25:04,625 - INFO - Overall Accuracy: 0.9728
2025-08-09 18:25:04,626 - INFO - Macro F1-Score: 0.9666
2025-08-09 18:25:04,627 - INFO - Micro F1-Score: 0.9728
2025-08-09 18:25:04,628 - INFO - Weighted F1-Score: 0.9728
2025-08-09 18:25:04,629 - INFO - Per-class Accuracy:
2025-08-09 18:25:04,630 - INFO -   angry: 0.9825
2025-08-09 18:25:04,630 - INFO -   disgust: 0.9383
2025-08-09 18:25:04,632 - INFO -   fear: 0.9606
2025-08-09 18:25:04,632 - INFO -   happy: 0.9678
2025-08-09 18:25:04,633 - INFO -   neutral: 0.9208
2025-08-09 18:25:04,634 - INFO -   sad: 0.9911
2025-08-09 18:25:04,635 - INFO -   surprised: 0.9764
2025-08-09 18:25:04,636 - INFO - Final evaluation completed with comprehensive metrics
2025-08-09 18:25:04,655 - INFO - Training completed!
