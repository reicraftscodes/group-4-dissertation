2025-08-24 12:49:59,008 - INFO - Class weights: tensor([0.7496, 2.7500, 1.7138, 0.4922, 5.3146, 0.6719, 0.9895],
       device='cuda:0')
2025-08-24 12:49:59,257 - INFO - Trainer initialized. Experiment: multimodal_vit_fer_combined_20250824_124943
2025-08-24 12:49:59,259 - INFO - Save directory: ./experiments/multimodal_vit_fer_combined_20250824_124943
2025-08-24 12:49:59,260 - INFO - Training mode: combined
2025-08-24 12:49:59,261 - INFO - Fusion strategy: late
2025-08-24 12:49:59,262 - INFO - Fusion type: attention
2025-08-24 12:49:59,263 - INFO - Fusion layer: feature
2025-08-24 12:49:59,264 - INFO - Training samples: 3,311
2025-08-24 12:49:59,265 - INFO - Test samples: 828
2025-08-24 12:49:59,265 - INFO - Use augmented data: True
2025-08-24 12:49:59,266 - INFO - Training configuration: {
  "data_dir": "Data",
  "output_dir": "./experiments",
  "mode": "combined",
  "fusion_strategy": "late",
  "fusion_type": "attention",
  "fusion_layer": "feature",
  "model_name": "google/vit-base-patch16-224-in21k",
  "num_classes": 7,
  "dropout_rate": 0.1,
  "freeze_backbone": false,
  "use_gradient_checkpointing": false,
  "batch_size": 32,
  "num_epochs": 30,
  "learning_rate": 5e-05,
  "weight_decay": 0.01,
  "warmup_steps": 500,
  "gradient_clip_norm": 1.0,
  "image_size": 224,
  "num_workers": 4,
  "val_split": 0.2,
  "use_augmented": true,
  "use_class_weights": true,
  "early_stopping_patience": 10,
  "early_stopping_min_delta": 0.001,
  "use_wandb": true,
  "wandb_project": "multimodal-fer"
}
2025-08-24 12:49:59,267 - INFO - Starting training for 30 epochs
2025-08-24 12:49:59,268 - INFO - 
=== Epoch 1/30 ===
2025-08-24 13:10:08,753 - INFO - Train - Loss: 2.0011, Acc: 0.2376, F1: 0.2203, Precision: 0.2425, Recall: 0.2376
2025-08-24 13:10:08,754 - INFO - Val   - Loss: 1.5436, Acc: 0.4167, F1: 0.3731, Precision: 0.3918, Recall: 0.4167
2025-08-24 13:10:16,166 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_combined_20250824_124943/best_model.pth
2025-08-24 13:10:16,168 - INFO - New best model saved with F1: 0.3731
2025-08-24 13:10:16,169 - INFO - 
=== Epoch 2/30 ===
2025-08-24 13:12:06,754 - INFO - Train - Loss: 1.3981, Acc: 0.4678, F1: 0.4396, Precision: 0.4596, Recall: 0.4678
2025-08-24 13:12:06,755 - INFO - Val   - Loss: 1.0661, Acc: 0.6039, F1: 0.5750, Precision: 0.6316, Recall: 0.6039
2025-08-24 13:12:12,219 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_combined_20250824_124943/best_model.pth
2025-08-24 13:12:12,221 - INFO - New best model saved with F1: 0.5750
2025-08-24 13:12:12,222 - INFO - 
=== Epoch 3/30 ===
2025-08-24 13:14:44,057 - INFO - Train - Loss: 0.9677, Acc: 0.6356, F1: 0.6180, Precision: 0.6341, Recall: 0.6356
2025-08-24 13:14:44,058 - INFO - Val   - Loss: 0.7570, Acc: 0.7029, F1: 0.6911, Precision: 0.7272, Recall: 0.7029
2025-08-24 13:14:49,705 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_combined_20250824_124943/best_model.pth
2025-08-24 13:14:49,772 - INFO - New best model saved with F1: 0.6911
2025-08-24 13:14:49,773 - INFO - 
=== Epoch 4/30 ===
2025-08-24 13:17:20,756 - INFO - Train - Loss: 0.7118, Acc: 0.7288, F1: 0.7211, Precision: 0.7268, Recall: 0.7288
2025-08-24 13:17:20,757 - INFO - Val   - Loss: 0.6053, Acc: 0.7681, F1: 0.7592, Precision: 0.7810, Recall: 0.7681
2025-08-24 13:17:26,304 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_combined_20250824_124943/best_model.pth
2025-08-24 13:17:26,306 - INFO - New best model saved with F1: 0.7592
2025-08-24 13:17:26,307 - INFO - 
=== Epoch 5/30 ===
2025-08-24 13:19:57,483 - INFO - Train - Loss: 0.5207, Acc: 0.8092, F1: 0.8063, Precision: 0.8094, Recall: 0.8092
2025-08-24 13:19:57,484 - INFO - Val   - Loss: 0.5207, Acc: 0.7959, F1: 0.7915, Precision: 0.8114, Recall: 0.7959
2025-08-24 13:20:02,442 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_combined_20250824_124943/best_model.pth
2025-08-24 13:20:02,445 - INFO - New best model saved with F1: 0.7915
2025-08-24 13:20:02,446 - INFO - 
=== Epoch 6/30 ===
2025-08-24 13:22:33,867 - INFO - Train - Loss: 0.3965, Acc: 0.8556, F1: 0.8548, Precision: 0.8560, Recall: 0.8556
2025-08-24 13:22:33,868 - INFO - Val   - Loss: 0.3633, Acc: 0.8696, F1: 0.8692, Precision: 0.8710, Recall: 0.8696
2025-08-24 13:22:38,825 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_combined_20250824_124943/best_model.pth
2025-08-24 13:22:38,828 - INFO - New best model saved with F1: 0.8692
2025-08-24 13:22:38,829 - INFO - 
=== Epoch 7/30 ===
2025-08-24 13:25:11,067 - INFO - Train - Loss: 0.2862, Acc: 0.8990, F1: 0.8985, Precision: 0.8992, Recall: 0.8990
2025-08-24 13:25:11,068 - INFO - Val   - Loss: 0.2992, Acc: 0.8973, F1: 0.8970, Precision: 0.9000, Recall: 0.8973
2025-08-24 13:25:16,036 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_combined_20250824_124943/best_model.pth
2025-08-24 13:25:16,039 - INFO - New best model saved with F1: 0.8970
2025-08-24 13:25:16,040 - INFO - 
=== Epoch 8/30 ===
2025-08-24 13:27:48,426 - INFO - Train - Loss: 0.2325, Acc: 0.9163, F1: 0.9161, Precision: 0.9163, Recall: 0.9163
2025-08-24 13:27:48,427 - INFO - Val   - Loss: 0.2439, Acc: 0.9143, F1: 0.9139, Precision: 0.9159, Recall: 0.9143
2025-08-24 13:27:53,498 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_combined_20250824_124943/best_model.pth
2025-08-24 13:27:53,500 - INFO - New best model saved with F1: 0.9139
2025-08-24 13:27:53,502 - INFO - 
=== Epoch 9/30 ===
2025-08-24 13:30:24,795 - INFO - Train - Loss: 0.1826, Acc: 0.9345, F1: 0.9344, Precision: 0.9345, Recall: 0.9345
2025-08-24 13:30:24,796 - INFO - Val   - Loss: 0.2330, Acc: 0.9094, F1: 0.9090, Precision: 0.9105, Recall: 0.9094
2025-08-24 13:30:24,798 - INFO - 
=== Epoch 10/30 ===
2025-08-24 13:32:23,330 - INFO - Train - Loss: 0.1502, Acc: 0.9454, F1: 0.9454, Precision: 0.9454, Recall: 0.9454
2025-08-24 13:32:23,331 - INFO - Val   - Loss: 0.1886, Acc: 0.9215, F1: 0.9213, Precision: 0.9218, Recall: 0.9215
2025-08-24 13:32:28,195 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_combined_20250824_124943/best_model.pth
2025-08-24 13:32:28,197 - INFO - New best model saved with F1: 0.9213
2025-08-24 13:32:28,313 - INFO - 
=== Epoch 11/30 ===
2025-08-24 13:34:59,747 - INFO - Train - Loss: 0.1177, Acc: 0.9581, F1: 0.9581, Precision: 0.9583, Recall: 0.9581
2025-08-24 13:34:59,747 - INFO - Val   - Loss: 0.1812, Acc: 0.9275, F1: 0.9273, Precision: 0.9282, Recall: 0.9275
2025-08-24 13:35:05,071 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_combined_20250824_124943/best_model.pth
2025-08-24 13:35:05,073 - INFO - New best model saved with F1: 0.9273
2025-08-24 13:35:05,074 - INFO - 
=== Epoch 12/30 ===
2025-08-24 13:37:37,103 - INFO - Train - Loss: 0.1101, Acc: 0.9572, F1: 0.9572, Precision: 0.9572, Recall: 0.9572
2025-08-24 13:37:37,104 - INFO - Val   - Loss: 0.1810, Acc: 0.9360, F1: 0.9357, Precision: 0.9382, Recall: 0.9360
2025-08-24 13:37:42,063 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_combined_20250824_124943/best_model.pth
2025-08-24 13:37:42,065 - INFO - New best model saved with F1: 0.9357
2025-08-24 13:37:42,066 - INFO - 
=== Epoch 13/30 ===
2025-08-24 13:40:14,410 - INFO - Train - Loss: 0.0992, Acc: 0.9627, F1: 0.9627, Precision: 0.9627, Recall: 0.9627
2025-08-24 13:40:14,411 - INFO - Val   - Loss: 0.1574, Acc: 0.9300, F1: 0.9298, Precision: 0.9311, Recall: 0.9300
2025-08-24 13:40:14,413 - INFO - 
=== Epoch 14/30 ===
2025-08-24 13:42:13,342 - INFO - Train - Loss: 0.0773, Acc: 0.9718, F1: 0.9717, Precision: 0.9718, Recall: 0.9718
2025-08-24 13:42:13,343 - INFO - Val   - Loss: 0.1556, Acc: 0.9444, F1: 0.9442, Precision: 0.9466, Recall: 0.9444
2025-08-24 13:42:18,176 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_combined_20250824_124943/best_model.pth
2025-08-24 13:42:18,178 - INFO - New best model saved with F1: 0.9442
2025-08-24 13:42:18,322 - INFO - 
=== Epoch 15/30 ===
2025-08-24 13:44:50,635 - INFO - Train - Loss: 0.0770, Acc: 0.9727, F1: 0.9727, Precision: 0.9728, Recall: 0.9727
2025-08-24 13:44:50,636 - INFO - Val   - Loss: 0.1460, Acc: 0.9420, F1: 0.9420, Precision: 0.9425, Recall: 0.9420
2025-08-24 13:44:50,638 - INFO - 
=== Epoch 16/30 ===
2025-08-24 13:46:41,281 - INFO - Train - Loss: 0.0566, Acc: 0.9794, F1: 0.9793, Precision: 0.9794, Recall: 0.9794
2025-08-24 13:46:41,282 - INFO - Val   - Loss: 0.1304, Acc: 0.9517, F1: 0.9516, Precision: 0.9523, Recall: 0.9517
2025-08-24 13:46:46,871 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_combined_20250824_124943/best_model.pth
2025-08-24 13:46:46,874 - INFO - New best model saved with F1: 0.9516
2025-08-24 13:46:46,876 - INFO - 
=== Epoch 17/30 ===
2025-08-24 13:49:18,650 - INFO - Train - Loss: 0.0592, Acc: 0.9821, F1: 0.9821, Precision: 0.9822, Recall: 0.9821
2025-08-24 13:49:18,654 - INFO - Val   - Loss: 0.1234, Acc: 0.9481, F1: 0.9480, Precision: 0.9488, Recall: 0.9481
2025-08-24 13:49:18,658 - INFO - 
=== Epoch 18/30 ===
2025-08-24 13:51:08,960 - INFO - Train - Loss: 0.0466, Acc: 0.9836, F1: 0.9836, Precision: 0.9836, Recall: 0.9836
2025-08-24 13:51:08,961 - INFO - Val   - Loss: 0.1310, Acc: 0.9493, F1: 0.9492, Precision: 0.9497, Recall: 0.9493
2025-08-24 13:51:08,963 - INFO - 
=== Epoch 19/30 ===
2025-08-24 13:52:59,438 - INFO - Train - Loss: 0.0463, Acc: 0.9836, F1: 0.9836, Precision: 0.9836, Recall: 0.9836
2025-08-24 13:52:59,439 - INFO - Val   - Loss: 0.1237, Acc: 0.9541, F1: 0.9540, Precision: 0.9543, Recall: 0.9541
2025-08-24 13:53:04,944 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_combined_20250824_124943/best_model.pth
2025-08-24 13:53:04,946 - INFO - New best model saved with F1: 0.9540
2025-08-24 13:53:05,003 - INFO - 
=== Epoch 20/30 ===
2025-08-24 13:55:36,371 - INFO - Train - Loss: 0.0388, Acc: 0.9851, F1: 0.9851, Precision: 0.9851, Recall: 0.9851
2025-08-24 13:55:36,371 - INFO - Val   - Loss: 0.1291, Acc: 0.9553, F1: 0.9552, Precision: 0.9565, Recall: 0.9553
2025-08-24 13:55:42,190 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_combined_20250824_124943/best_model.pth
2025-08-24 13:55:42,192 - INFO - New best model saved with F1: 0.9552
2025-08-24 13:55:42,194 - INFO - 
=== Epoch 21/30 ===
2025-08-24 13:58:14,267 - INFO - Train - Loss: 0.0334, Acc: 0.9891, F1: 0.9891, Precision: 0.9891, Recall: 0.9891
2025-08-24 13:58:14,268 - INFO - Val   - Loss: 0.1078, Acc: 0.9601, F1: 0.9603, Precision: 0.9611, Recall: 0.9601
2025-08-24 13:58:19,248 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_combined_20250824_124943/best_model.pth
2025-08-24 13:58:19,250 - INFO - New best model saved with F1: 0.9603
2025-08-24 13:58:19,252 - INFO - 
=== Epoch 22/30 ===
2025-08-24 14:00:51,492 - INFO - Train - Loss: 0.0280, Acc: 0.9921, F1: 0.9921, Precision: 0.9921, Recall: 0.9921
2025-08-24 14:00:51,493 - INFO - Val   - Loss: 0.1071, Acc: 0.9541, F1: 0.9541, Precision: 0.9543, Recall: 0.9541
2025-08-24 14:00:51,496 - INFO - 
=== Epoch 23/30 ===
