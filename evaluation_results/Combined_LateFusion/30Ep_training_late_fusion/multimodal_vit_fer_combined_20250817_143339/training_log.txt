2025-08-17 14:33:40,763 - INFO - Class weights: tensor([0.7520, 2.6875, 1.7014, 0.4817, 6.2237, 0.6738, 1.0107],
       device='cuda:0')
2025-08-17 14:33:40,765 - INFO - Trainer initialized. Experiment: multimodal_vit_fer_combined_20250817_143339
2025-08-17 14:33:40,766 - INFO - Save directory: ./experiments/multimodal_vit_fer_combined_20250817_143339
2025-08-17 14:33:40,767 - INFO - Training mode: combined
2025-08-17 14:33:40,768 - INFO - Fusion strategy: late
2025-08-17 14:33:40,768 - INFO - Fusion type: attention
2025-08-17 14:33:40,769 - INFO - Fusion layer: feature
2025-08-17 14:33:40,770 - INFO - Training samples: 3,311
2025-08-17 14:33:40,771 - INFO - Test samples: 828
2025-08-17 14:33:40,771 - INFO - Use augmented data: True
2025-08-17 14:33:40,772 - INFO - Training configuration: {
  "data_dir": "Data",
  "output_dir": "./experiments",
  "mode": "combined",
  "fusion_strategy": "late",
  "fusion_type": "attention",
  "fusion_layer": "feature",
  "model_name": "google/vit-base-patch16-224-in21k",
  "num_classes": 7,
  "dropout_rate": 0.1,
  "freeze_backbone": false,
  "use_gradient_checkpointing": false,
  "batch_size": 32,
  "num_epochs": 30,
  "learning_rate": 5e-05,
  "weight_decay": 0.01,
  "warmup_steps": 500,
  "gradient_clip_norm": 1.0,
  "image_size": 224,
  "num_workers": 4,
  "val_split": 0.2,
  "use_augmented": true,
  "use_class_weights": true,
  "early_stopping_patience": 10,
  "early_stopping_min_delta": 0.001,
  "use_wandb": false,
  "wandb_project": "multimodal-fer"
}
2025-08-17 14:33:40,773 - INFO - Starting training for 30 epochs
2025-08-17 14:33:40,774 - INFO - 
=== Epoch 1/30 ===
2025-08-17 14:40:57,335 - INFO - Train - Loss: 2.0067, Acc: 0.2206, F1: 0.2081, Precision: 0.2116, Recall: 0.2206
2025-08-17 14:40:57,336 - INFO - Val   - Loss: 1.7031, Acc: 0.3164, F1: 0.2815, Precision: 0.2826, Recall: 0.3164
2025-08-17 14:41:01,773 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_combined_20250817_143339/best_model.pth
2025-08-17 14:41:01,775 - INFO - New best model saved with F1: 0.2815
2025-08-17 14:41:01,775 - INFO - 
=== Epoch 2/30 ===
2025-08-17 14:42:52,716 - INFO - Train - Loss: 1.3929, Acc: 0.4697, F1: 0.4432, Precision: 0.4467, Recall: 0.4697
2025-08-17 14:42:52,717 - INFO - Val   - Loss: 1.1813, Acc: 0.5435, F1: 0.5081, Precision: 0.5465, Recall: 0.5435
2025-08-17 14:42:57,472 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_combined_20250817_143339/best_model.pth
2025-08-17 14:42:57,474 - INFO - New best model saved with F1: 0.5081
2025-08-17 14:42:57,475 - INFO - 
=== Epoch 3/30 ===
2025-08-17 14:45:28,688 - INFO - Train - Loss: 0.9745, Acc: 0.6296, F1: 0.6150, Precision: 0.6225, Recall: 0.6296
2025-08-17 14:45:28,688 - INFO - Val   - Loss: 0.8644, Acc: 0.6848, F1: 0.6707, Precision: 0.6648, Recall: 0.6848
2025-08-17 14:45:33,374 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_combined_20250817_143339/best_model.pth
2025-08-17 14:45:33,376 - INFO - New best model saved with F1: 0.6707
2025-08-17 14:45:33,377 - INFO - 
=== Epoch 4/30 ===
2025-08-17 14:48:03,877 - INFO - Train - Loss: 0.7303, Acc: 0.7212, F1: 0.7124, Precision: 0.7154, Recall: 0.7212
2025-08-17 14:48:03,878 - INFO - Val   - Loss: 0.7458, Acc: 0.7029, F1: 0.6833, Precision: 0.6989, Recall: 0.7029
2025-08-17 14:48:08,717 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_combined_20250817_143339/best_model.pth
2025-08-17 14:48:08,719 - INFO - New best model saved with F1: 0.6833
2025-08-17 14:48:08,720 - INFO - 
=== Epoch 5/30 ===
2025-08-17 14:50:39,283 - INFO - Train - Loss: 0.5508, Acc: 0.7922, F1: 0.7871, Precision: 0.7923, Recall: 0.7922
2025-08-17 14:50:39,284 - INFO - Val   - Loss: 0.5266, Acc: 0.8031, F1: 0.7956, Precision: 0.8132, Recall: 0.8031
2025-08-17 14:50:44,424 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_combined_20250817_143339/best_model.pth
2025-08-17 14:50:44,426 - INFO - New best model saved with F1: 0.7956
2025-08-17 14:50:44,426 - INFO - 
=== Epoch 6/30 ===
2025-08-17 14:53:14,618 - INFO - Train - Loss: 0.4058, Acc: 0.8547, F1: 0.8532, Precision: 0.8552, Recall: 0.8547
2025-08-17 14:53:14,619 - INFO - Val   - Loss: 0.5180, Acc: 0.7995, F1: 0.7987, Precision: 0.8347, Recall: 0.7995
2025-08-17 14:53:19,398 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_combined_20250817_143339/best_model.pth
2025-08-17 14:53:19,400 - INFO - New best model saved with F1: 0.7987
2025-08-17 14:53:19,401 - INFO - 
=== Epoch 7/30 ===
2025-08-17 14:55:50,389 - INFO - Train - Loss: 0.3217, Acc: 0.8832, F1: 0.8826, Precision: 0.8831, Recall: 0.8832
2025-08-17 14:55:50,389 - INFO - Val   - Loss: 0.4506, Acc: 0.8128, F1: 0.8148, Precision: 0.8434, Recall: 0.8128
2025-08-17 14:55:55,199 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_combined_20250817_143339/best_model.pth
2025-08-17 14:55:55,200 - INFO - New best model saved with F1: 0.8148
2025-08-17 14:55:55,201 - INFO - 
=== Epoch 8/30 ===
2025-08-17 14:58:26,408 - INFO - Train - Loss: 0.2484, Acc: 0.9062, F1: 0.9058, Precision: 0.9061, Recall: 0.9062
2025-08-17 14:58:26,409 - INFO - Val   - Loss: 0.2848, Acc: 0.8901, F1: 0.8895, Precision: 0.8952, Recall: 0.8901
2025-08-17 14:58:31,312 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_combined_20250817_143339/best_model.pth
2025-08-17 14:58:31,314 - INFO - New best model saved with F1: 0.8895
2025-08-17 14:58:31,315 - INFO - 
=== Epoch 9/30 ===
2025-08-17 15:01:00,690 - INFO - Train - Loss: 0.2023, Acc: 0.9254, F1: 0.9252, Precision: 0.9258, Recall: 0.9254
2025-08-17 15:01:00,691 - INFO - Val   - Loss: 0.2506, Acc: 0.9082, F1: 0.9078, Precision: 0.9115, Recall: 0.9082
2025-08-17 15:01:05,336 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_combined_20250817_143339/best_model.pth
2025-08-17 15:01:05,338 - INFO - New best model saved with F1: 0.9078
2025-08-17 15:01:05,338 - INFO - 
=== Epoch 10/30 ===
2025-08-17 15:03:35,458 - INFO - Train - Loss: 0.1731, Acc: 0.9381, F1: 0.9379, Precision: 0.9381, Recall: 0.9381
2025-08-17 15:03:35,459 - INFO - Val   - Loss: 0.2436, Acc: 0.9118, F1: 0.9116, Precision: 0.9209, Recall: 0.9118
2025-08-17 15:03:40,430 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_combined_20250817_143339/best_model.pth
2025-08-17 15:03:40,432 - INFO - New best model saved with F1: 0.9116
2025-08-17 15:03:40,432 - INFO - 
=== Epoch 11/30 ===
2025-08-17 15:06:10,116 - INFO - Train - Loss: 0.1337, Acc: 0.9524, F1: 0.9522, Precision: 0.9526, Recall: 0.9524
2025-08-17 15:06:10,117 - INFO - Val   - Loss: 0.1779, Acc: 0.9372, F1: 0.9366, Precision: 0.9388, Recall: 0.9372
2025-08-17 15:06:16,891 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_combined_20250817_143339/best_model.pth
2025-08-17 15:06:16,893 - INFO - New best model saved with F1: 0.9366
2025-08-17 15:06:16,900 - INFO - 
=== Epoch 12/30 ===
2025-08-17 15:08:45,197 - INFO - Train - Loss: 0.1198, Acc: 0.9563, F1: 0.9563, Precision: 0.9563, Recall: 0.9563
2025-08-17 15:08:45,198 - INFO - Val   - Loss: 0.1613, Acc: 0.9469, F1: 0.9470, Precision: 0.9496, Recall: 0.9469
2025-08-17 15:08:49,970 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_combined_20250817_143339/best_model.pth
2025-08-17 15:08:49,971 - INFO - New best model saved with F1: 0.9470
2025-08-17 15:08:49,972 - INFO - 
=== Epoch 13/30 ===
2025-08-17 15:11:20,238 - INFO - Train - Loss: 0.1133, Acc: 0.9578, F1: 0.9578, Precision: 0.9578, Recall: 0.9578
2025-08-17 15:11:20,239 - INFO - Val   - Loss: 0.1268, Acc: 0.9589, F1: 0.9588, Precision: 0.9595, Recall: 0.9589
2025-08-17 15:11:25,103 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_combined_20250817_143339/best_model.pth
2025-08-17 15:11:25,105 - INFO - New best model saved with F1: 0.9588
2025-08-17 15:11:25,106 - INFO - 
=== Epoch 14/30 ===
2025-08-17 15:13:55,149 - INFO - Train - Loss: 0.0929, Acc: 0.9636, F1: 0.9634, Precision: 0.9636, Recall: 0.9636
2025-08-17 15:13:55,150 - INFO - Val   - Loss: 0.1260, Acc: 0.9553, F1: 0.9552, Precision: 0.9562, Recall: 0.9553
2025-08-17 15:13:55,151 - INFO - 
=== Epoch 15/30 ===
2025-08-17 15:15:43,497 - INFO - Train - Loss: 0.0884, Acc: 0.9681, F1: 0.9680, Precision: 0.9681, Recall: 0.9681
2025-08-17 15:15:43,497 - INFO - Val   - Loss: 0.1253, Acc: 0.9589, F1: 0.9588, Precision: 0.9596, Recall: 0.9589
2025-08-17 15:15:48,320 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_combined_20250817_143339/best_model.pth
2025-08-17 15:15:48,322 - INFO - New best model saved with F1: 0.9588
2025-08-17 15:15:48,322 - INFO - 
=== Epoch 16/30 ===
2025-08-17 15:18:19,111 - INFO - Train - Loss: 0.0756, Acc: 0.9754, F1: 0.9754, Precision: 0.9754, Recall: 0.9754
2025-08-17 15:18:19,112 - INFO - Val   - Loss: 0.0973, Acc: 0.9722, F1: 0.9723, Precision: 0.9730, Recall: 0.9722
2025-08-17 15:18:23,891 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_combined_20250817_143339/best_model.pth
2025-08-17 15:18:23,893 - INFO - New best model saved with F1: 0.9723
2025-08-17 15:18:23,893 - INFO - 
=== Epoch 17/30 ===
2025-08-17 15:20:53,907 - INFO - Train - Loss: 0.0608, Acc: 0.9794, F1: 0.9793, Precision: 0.9794, Recall: 0.9794
2025-08-17 15:20:53,908 - INFO - Val   - Loss: 0.0822, Acc: 0.9746, F1: 0.9746, Precision: 0.9749, Recall: 0.9746
2025-08-17 15:20:58,696 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_combined_20250817_143339/best_model.pth
2025-08-17 15:20:58,698 - INFO - New best model saved with F1: 0.9746
2025-08-17 15:20:58,699 - INFO - 
=== Epoch 18/30 ===
2025-08-17 15:23:28,497 - INFO - Train - Loss: 0.0523, Acc: 0.9812, F1: 0.9812, Precision: 0.9812, Recall: 0.9812
2025-08-17 15:23:28,498 - INFO - Val   - Loss: 0.0834, Acc: 0.9771, F1: 0.9771, Precision: 0.9774, Recall: 0.9771
2025-08-17 15:23:33,265 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_combined_20250817_143339/best_model.pth
2025-08-17 15:23:33,266 - INFO - New best model saved with F1: 0.9771
2025-08-17 15:23:33,267 - INFO - 
=== Epoch 19/30 ===
2025-08-17 15:26:04,738 - INFO - Train - Loss: 0.0556, Acc: 0.9806, F1: 0.9806, Precision: 0.9806, Recall: 0.9806
2025-08-17 15:26:04,739 - INFO - Val   - Loss: 0.0756, Acc: 0.9783, F1: 0.9783, Precision: 0.9784, Recall: 0.9783
2025-08-17 15:26:10,023 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_combined_20250817_143339/best_model.pth
2025-08-17 15:26:10,024 - INFO - New best model saved with F1: 0.9783
2025-08-17 15:26:10,025 - INFO - 
=== Epoch 20/30 ===
2025-08-17 15:28:40,473 - INFO - Train - Loss: 0.0487, Acc: 0.9806, F1: 0.9805, Precision: 0.9806, Recall: 0.9806
2025-08-17 15:28:40,474 - INFO - Val   - Loss: 0.0747, Acc: 0.9771, F1: 0.9770, Precision: 0.9773, Recall: 0.9771
2025-08-17 15:28:40,475 - INFO - 
=== Epoch 21/30 ===
2025-08-17 15:30:29,076 - INFO - Train - Loss: 0.0362, Acc: 0.9870, F1: 0.9869, Precision: 0.9869, Recall: 0.9870
2025-08-17 15:30:29,077 - INFO - Val   - Loss: 0.0863, Acc: 0.9734, F1: 0.9733, Precision: 0.9738, Recall: 0.9734
2025-08-17 15:30:29,078 - INFO - 
=== Epoch 22/30 ===
2025-08-17 15:32:17,414 - INFO - Train - Loss: 0.0410, Acc: 0.9870, F1: 0.9869, Precision: 0.9870, Recall: 0.9870
2025-08-17 15:32:17,415 - INFO - Val   - Loss: 0.0835, Acc: 0.9722, F1: 0.9722, Precision: 0.9727, Recall: 0.9722
2025-08-17 15:32:17,416 - INFO - 
=== Epoch 23/30 ===
2025-08-17 15:34:05,686 - INFO - Train - Loss: 0.0345, Acc: 0.9873, F1: 0.9872, Precision: 0.9873, Recall: 0.9873
2025-08-17 15:34:05,687 - INFO - Val   - Loss: 0.0707, Acc: 0.9807, F1: 0.9807, Precision: 0.9809, Recall: 0.9807
2025-08-17 15:34:10,624 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_combined_20250817_143339/best_model.pth
2025-08-17 15:34:10,626 - INFO - New best model saved with F1: 0.9807
2025-08-17 15:34:10,627 - INFO - 
=== Epoch 24/30 ===
2025-08-17 15:36:42,056 - INFO - Train - Loss: 0.0304, Acc: 0.9894, F1: 0.9894, Precision: 0.9894, Recall: 0.9894
2025-08-17 15:36:42,057 - INFO - Val   - Loss: 0.0712, Acc: 0.9795, F1: 0.9795, Precision: 0.9796, Recall: 0.9795
2025-08-17 15:36:42,058 - INFO - 
=== Epoch 25/30 ===
2025-08-17 15:38:30,458 - INFO - Train - Loss: 0.0287, Acc: 0.9900, F1: 0.9900, Precision: 0.9900, Recall: 0.9900
2025-08-17 15:38:30,458 - INFO - Val   - Loss: 0.0685, Acc: 0.9807, F1: 0.9807, Precision: 0.9808, Recall: 0.9807
2025-08-17 15:38:30,459 - INFO - 
=== Epoch 26/30 ===
2025-08-17 15:40:18,769 - INFO - Train - Loss: 0.0347, Acc: 0.9870, F1: 0.9870, Precision: 0.9870, Recall: 0.9870
2025-08-17 15:40:18,770 - INFO - Val   - Loss: 0.0678, Acc: 0.9819, F1: 0.9819, Precision: 0.9820, Recall: 0.9819
2025-08-17 15:40:23,512 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_combined_20250817_143339/best_model.pth
2025-08-17 15:40:23,514 - INFO - New best model saved with F1: 0.9819
2025-08-17 15:40:23,515 - INFO - 
=== Epoch 27/30 ===
2025-08-17 15:42:54,975 - INFO - Train - Loss: 0.0276, Acc: 0.9909, F1: 0.9909, Precision: 0.9909, Recall: 0.9909
2025-08-17 15:42:54,976 - INFO - Val   - Loss: 0.0701, Acc: 0.9795, F1: 0.9794, Precision: 0.9796, Recall: 0.9795
2025-08-17 15:42:54,977 - INFO - 
=== Epoch 28/30 ===
2025-08-17 15:44:43,293 - INFO - Train - Loss: 0.0312, Acc: 0.9882, F1: 0.9882, Precision: 0.9882, Recall: 0.9882
2025-08-17 15:44:43,294 - INFO - Val   - Loss: 0.0681, Acc: 0.9819, F1: 0.9819, Precision: 0.9820, Recall: 0.9819
2025-08-17 15:44:48,064 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_combined_20250817_143339/best_model.pth
2025-08-17 15:44:48,066 - INFO - New best model saved with F1: 0.9819
2025-08-17 15:44:48,067 - INFO - 
=== Epoch 29/30 ===
2025-08-17 15:47:17,719 - INFO - Train - Loss: 0.0375, Acc: 0.9870, F1: 0.9869, Precision: 0.9869, Recall: 0.9870
2025-08-17 15:47:17,720 - INFO - Val   - Loss: 0.0676, Acc: 0.9831, F1: 0.9831, Precision: 0.9832, Recall: 0.9831
2025-08-17 15:47:22,466 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_combined_20250817_143339/best_model.pth
2025-08-17 15:47:22,468 - INFO - New best model saved with F1: 0.9831
2025-08-17 15:47:22,468 - INFO - 
=== Epoch 30/30 ===
2025-08-17 15:49:52,579 - INFO - Train - Loss: 0.0318, Acc: 0.9867, F1: 0.9866, Precision: 0.9867, Recall: 0.9867
2025-08-17 15:49:52,580 - INFO - Val   - Loss: 0.0677, Acc: 0.9831, F1: 0.9831, Precision: 0.9832, Recall: 0.9831
2025-08-17 15:49:57,195 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_combined_20250817_143339/last_model.pth
2025-08-17 15:50:01,535 - INFO - === DETAILED EVALUATION RESULTS ===
2025-08-17 15:50:01,536 - INFO - Overall Accuracy: 0.9831
2025-08-17 15:50:01,537 - INFO - Macro F1-Score: 0.9814
2025-08-17 15:50:01,537 - INFO - Micro F1-Score: 0.9831
2025-08-17 15:50:01,538 - INFO - Weighted F1-Score: 0.9831
2025-08-17 15:50:01,539 - INFO - Per-class Accuracy:
2025-08-17 15:50:01,540 - INFO -   angry: 0.9868
2025-08-17 15:50:01,540 - INFO -   disgust: 0.9778
2025-08-17 15:50:01,541 - INFO -   fear: 0.9412
2025-08-17 15:50:01,542 - INFO -   happy: 0.9866
2025-08-17 15:50:01,543 - INFO -   neutral: 0.9630
2025-08-17 15:50:01,543 - INFO -   sad: 0.9945
2025-08-17 15:50:01,544 - INFO -   surprised: 0.9848
2025-08-17 15:50:01,545 - INFO - Final evaluation completed with comprehensive metrics
2025-08-17 15:50:01,555 - INFO - Training completed!
