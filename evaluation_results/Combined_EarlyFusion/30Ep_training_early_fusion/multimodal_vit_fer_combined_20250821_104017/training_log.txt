2025-08-21 10:41:45,623 - INFO - Class weights: tensor([0.7592, 2.5707, 1.7326, 0.4907, 5.7683, 0.6662, 0.9958],
       device='cuda:0')
2025-08-21 10:41:45,644 - INFO - Trainer initialized. Experiment: multimodal_vit_fer_combined_20250821_104017
2025-08-21 10:41:45,645 - INFO - Save directory: ./experiments/multimodal_vit_fer_combined_20250821_104017
2025-08-21 10:41:45,646 - INFO - Training mode: combined
2025-08-21 10:41:45,648 - INFO - Fusion strategy: early
2025-08-21 10:41:45,648 - INFO - Fusion type: concat
2025-08-21 10:41:45,649 - INFO - Fusion layer: 
2025-08-21 10:41:45,650 - INFO - Training samples: 3,311
2025-08-21 10:41:45,650 - INFO - Test samples: 828
2025-08-21 10:41:45,651 - INFO - Use augmented data: True
2025-08-21 10:41:45,652 - INFO - Training configuration: {
  "data_dir": "Data",
  "output_dir": "./experiments",
  "mode": "combined",
  "fusion_strategy": "early",
  "fusion_type": "concat",
  "fusion_layer": "",
  "model_name": "google/vit-base-patch16-224-in21k",
  "num_classes": 7,
  "dropout_rate": 0.1,
  "freeze_backbone": false,
  "use_gradient_checkpointing": false,
  "batch_size": 32,
  "num_epochs": 30,
  "learning_rate": 5e-05,
  "weight_decay": 0.01,
  "warmup_steps": 500,
  "gradient_clip_norm": 1.0,
  "image_size": 224,
  "num_workers": 4,
  "val_split": 0.2,
  "use_augmented": true,
  "use_class_weights": true,
  "early_stopping_patience": 10,
  "early_stopping_min_delta": 0.001,
  "use_wandb": true,
  "wandb_project": "multimodal-fer"
}
2025-08-21 10:41:45,653 - INFO - Starting training for 30 epochs
2025-08-21 10:41:45,654 - INFO - 
=== Epoch 1/30 ===
2025-08-21 10:58:22,431 - INFO - Train - Loss: 2.1428, Acc: 0.2521, F1: 0.2202, Precision: 0.2970, Recall: 0.2521
2025-08-21 10:58:22,432 - INFO - Val   - Loss: 1.6738, Acc: 0.3514, F1: 0.3544, Precision: 0.3651, Recall: 0.3514
2025-08-21 10:58:24,695 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_combined_20250821_104017/best_model.pth
2025-08-21 10:58:24,696 - INFO - New best model saved with F1: 0.3544
2025-08-21 10:58:24,698 - INFO - 
=== Epoch 2/30 ===
2025-08-21 10:59:19,272 - INFO - Train - Loss: 1.5232, Acc: 0.4154, F1: 0.3909, Precision: 0.3831, Recall: 0.4154
2025-08-21 10:59:19,273 - INFO - Val   - Loss: 1.3076, Acc: 0.4758, F1: 0.4402, Precision: 0.4656, Recall: 0.4758
2025-08-21 10:59:21,604 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_combined_20250821_104017/best_model.pth
2025-08-21 10:59:21,606 - INFO - New best model saved with F1: 0.4402
2025-08-21 10:59:21,634 - INFO - 
=== Epoch 3/30 ===
2025-08-21 11:00:34,139 - INFO - Train - Loss: 1.2867, Acc: 0.4967, F1: 0.4707, Precision: 0.4653, Recall: 0.4967
2025-08-21 11:00:34,140 - INFO - Val   - Loss: 1.1001, Acc: 0.5242, F1: 0.5054, Precision: 0.5064, Recall: 0.5242
2025-08-21 11:00:36,597 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_combined_20250821_104017/best_model.pth
2025-08-21 11:00:36,599 - INFO - New best model saved with F1: 0.5054
2025-08-21 11:00:36,601 - INFO - 
=== Epoch 4/30 ===
2025-08-21 11:01:49,674 - INFO - Train - Loss: 1.1461, Acc: 0.5258, F1: 0.5085, Precision: 0.5071, Recall: 0.5258
2025-08-21 11:01:49,674 - INFO - Val   - Loss: 0.9889, Acc: 0.5338, F1: 0.5182, Precision: 0.5420, Recall: 0.5338
2025-08-21 11:01:52,165 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_combined_20250821_104017/best_model.pth
2025-08-21 11:01:52,166 - INFO - New best model saved with F1: 0.5182
2025-08-21 11:01:52,168 - INFO - 
=== Epoch 5/30 ===
2025-08-21 11:03:05,611 - INFO - Train - Loss: 1.0194, Acc: 0.5762, F1: 0.5638, Precision: 0.5663, Recall: 0.5762
2025-08-21 11:03:05,612 - INFO - Val   - Loss: 0.8991, Acc: 0.6244, F1: 0.6150, Precision: 0.6286, Recall: 0.6244
2025-08-21 11:03:08,124 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_combined_20250821_104017/best_model.pth
2025-08-21 11:03:08,126 - INFO - New best model saved with F1: 0.6150
2025-08-21 11:03:08,128 - INFO - 
=== Epoch 6/30 ===
2025-08-21 11:04:21,749 - INFO - Train - Loss: 0.9300, Acc: 0.6192, F1: 0.6079, Precision: 0.6119, Recall: 0.6192
2025-08-21 11:04:21,750 - INFO - Val   - Loss: 0.7958, Acc: 0.6787, F1: 0.6695, Precision: 0.6688, Recall: 0.6787
2025-08-21 11:04:24,325 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_combined_20250821_104017/best_model.pth
2025-08-21 11:04:24,326 - INFO - New best model saved with F1: 0.6695
2025-08-21 11:04:24,327 - INFO - 
=== Epoch 7/30 ===
2025-08-21 11:05:37,512 - INFO - Train - Loss: 0.8576, Acc: 0.6390, F1: 0.6295, Precision: 0.6316, Recall: 0.6390
2025-08-21 11:05:37,513 - INFO - Val   - Loss: 0.7422, Acc: 0.7005, F1: 0.6903, Precision: 0.7181, Recall: 0.7005
2025-08-21 11:05:40,003 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_combined_20250821_104017/best_model.pth
2025-08-21 11:05:40,004 - INFO - New best model saved with F1: 0.6903
2025-08-21 11:05:40,006 - INFO - 
=== Epoch 8/30 ===
2025-08-21 11:06:53,680 - INFO - Train - Loss: 0.7936, Acc: 0.6778, F1: 0.6705, Precision: 0.6759, Recall: 0.6778
2025-08-21 11:06:53,682 - INFO - Val   - Loss: 0.6776, Acc: 0.7210, F1: 0.7136, Precision: 0.7148, Recall: 0.7210
2025-08-21 11:06:56,168 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_combined_20250821_104017/best_model.pth
2025-08-21 11:06:56,170 - INFO - New best model saved with F1: 0.7136
2025-08-21 11:06:56,172 - INFO - 
=== Epoch 9/30 ===
2025-08-21 11:08:09,858 - INFO - Train - Loss: 0.7419, Acc: 0.6917, F1: 0.6853, Precision: 0.6868, Recall: 0.6917
2025-08-21 11:08:09,859 - INFO - Val   - Loss: 0.6391, Acc: 0.7488, F1: 0.7424, Precision: 0.7651, Recall: 0.7488
2025-08-21 11:08:12,428 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_combined_20250821_104017/best_model.pth
2025-08-21 11:08:12,429 - INFO - New best model saved with F1: 0.7424
2025-08-21 11:08:12,431 - INFO - 
=== Epoch 10/30 ===
2025-08-21 11:09:26,713 - INFO - Train - Loss: 0.7031, Acc: 0.7145, F1: 0.7100, Precision: 0.7128, Recall: 0.7145
2025-08-21 11:09:26,714 - INFO - Val   - Loss: 0.6251, Acc: 0.7440, F1: 0.7392, Precision: 0.7686, Recall: 0.7440
2025-08-21 11:09:26,716 - INFO - 
=== Epoch 11/30 ===
2025-08-21 11:10:25,485 - INFO - Train - Loss: 0.6510, Acc: 0.7336, F1: 0.7300, Precision: 0.7338, Recall: 0.7336
2025-08-21 11:10:25,486 - INFO - Val   - Loss: 0.5499, Acc: 0.7742, F1: 0.7714, Precision: 0.7842, Recall: 0.7742
2025-08-21 11:10:28,235 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_combined_20250821_104017/best_model.pth
2025-08-21 11:10:28,237 - INFO - New best model saved with F1: 0.7714
2025-08-21 11:10:28,239 - INFO - 
=== Epoch 12/30 ===
2025-08-21 11:11:41,661 - INFO - Train - Loss: 0.6222, Acc: 0.7382, F1: 0.7353, Precision: 0.7378, Recall: 0.7382
2025-08-21 11:11:41,662 - INFO - Val   - Loss: 0.5782, Acc: 0.7597, F1: 0.7563, Precision: 0.7785, Recall: 0.7597
2025-08-21 11:11:41,664 - INFO - 
=== Epoch 13/30 ===
2025-08-21 11:12:35,789 - INFO - Train - Loss: 0.5725, Acc: 0.7688, F1: 0.7664, Precision: 0.7681, Recall: 0.7688
2025-08-21 11:12:35,790 - INFO - Val   - Loss: 0.4925, Acc: 0.8007, F1: 0.7991, Precision: 0.8164, Recall: 0.8007
2025-08-21 11:12:38,237 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_combined_20250821_104017/best_model.pth
2025-08-21 11:12:38,239 - INFO - New best model saved with F1: 0.7991
2025-08-21 11:12:38,240 - INFO - 
=== Epoch 14/30 ===
2025-08-21 11:13:51,994 - INFO - Train - Loss: 0.5536, Acc: 0.7749, F1: 0.7721, Precision: 0.7740, Recall: 0.7749
2025-08-21 11:13:51,995 - INFO - Val   - Loss: 0.4838, Acc: 0.8080, F1: 0.8090, Precision: 0.8226, Recall: 0.8080
2025-08-21 11:13:54,503 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_combined_20250821_104017/best_model.pth
2025-08-21 11:13:54,505 - INFO - New best model saved with F1: 0.8090
2025-08-21 11:13:54,507 - INFO - 
=== Epoch 15/30 ===
2025-08-21 11:15:07,827 - INFO - Train - Loss: 0.5427, Acc: 0.7822, F1: 0.7806, Precision: 0.7817, Recall: 0.7822
2025-08-21 11:15:07,830 - INFO - Val   - Loss: 0.4811, Acc: 0.8092, F1: 0.8092, Precision: 0.8259, Recall: 0.8092
2025-08-21 11:15:10,334 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_combined_20250821_104017/best_model.pth
2025-08-21 11:15:10,336 - INFO - New best model saved with F1: 0.8092
2025-08-21 11:15:10,337 - INFO - 
=== Epoch 16/30 ===
2025-08-21 11:16:23,738 - INFO - Train - Loss: 0.5263, Acc: 0.7837, F1: 0.7828, Precision: 0.7842, Recall: 0.7837
2025-08-21 11:16:23,739 - INFO - Val   - Loss: 0.4613, Acc: 0.8092, F1: 0.8075, Precision: 0.8188, Recall: 0.8092
2025-08-21 11:16:23,741 - INFO - 
=== Epoch 17/30 ===
2025-08-21 11:17:22,552 - INFO - Train - Loss: 0.5074, Acc: 0.8083, F1: 0.8072, Precision: 0.8078, Recall: 0.8083
2025-08-21 11:17:22,553 - INFO - Val   - Loss: 0.4342, Acc: 0.8261, F1: 0.8254, Precision: 0.8304, Recall: 0.8261
2025-08-21 11:17:24,919 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_combined_20250821_104017/best_model.pth
2025-08-21 11:17:24,921 - INFO - New best model saved with F1: 0.8254
2025-08-21 11:17:24,923 - INFO - 
=== Epoch 18/30 ===
2025-08-21 11:18:38,803 - INFO - Train - Loss: 0.4909, Acc: 0.7967, F1: 0.7956, Precision: 0.7962, Recall: 0.7967
2025-08-21 11:18:38,804 - INFO - Val   - Loss: 0.4190, Acc: 0.8382, F1: 0.8369, Precision: 0.8440, Recall: 0.8382
2025-08-21 11:18:41,156 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_combined_20250821_104017/best_model.pth
2025-08-21 11:18:41,158 - INFO - New best model saved with F1: 0.8369
2025-08-21 11:18:41,159 - INFO - 
=== Epoch 19/30 ===
2025-08-21 11:19:54,211 - INFO - Train - Loss: 0.4755, Acc: 0.8046, F1: 0.8034, Precision: 0.8041, Recall: 0.8046
2025-08-21 11:19:54,212 - INFO - Val   - Loss: 0.4370, Acc: 0.8080, F1: 0.8076, Precision: 0.8174, Recall: 0.8080
2025-08-21 11:19:54,214 - INFO - 
=== Epoch 20/30 ===
2025-08-21 11:20:52,967 - INFO - Train - Loss: 0.4613, Acc: 0.8149, F1: 0.8140, Precision: 0.8140, Recall: 0.8149
2025-08-21 11:20:52,968 - INFO - Val   - Loss: 0.4139, Acc: 0.8406, F1: 0.8378, Precision: 0.8468, Recall: 0.8406
2025-08-21 11:20:55,380 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_combined_20250821_104017/best_model.pth
2025-08-21 11:20:55,382 - INFO - New best model saved with F1: 0.8378
2025-08-21 11:20:55,407 - INFO - 
=== Epoch 21/30 ===
2025-08-21 11:22:08,988 - INFO - Train - Loss: 0.4454, Acc: 0.8189, F1: 0.8185, Precision: 0.8198, Recall: 0.8189
2025-08-21 11:22:08,989 - INFO - Val   - Loss: 0.4072, Acc: 0.8285, F1: 0.8265, Precision: 0.8379, Recall: 0.8285
2025-08-21 11:22:08,991 - INFO - 
=== Epoch 22/30 ===
2025-08-21 11:23:03,112 - INFO - Train - Loss: 0.4388, Acc: 0.8192, F1: 0.8183, Precision: 0.8191, Recall: 0.8192
2025-08-21 11:23:03,113 - INFO - Val   - Loss: 0.4080, Acc: 0.8273, F1: 0.8251, Precision: 0.8352, Recall: 0.8273
2025-08-21 11:23:03,115 - INFO - 
=== Epoch 23/30 ===
2025-08-21 11:23:57,623 - INFO - Train - Loss: 0.4135, Acc: 0.8413, F1: 0.8400, Precision: 0.8405, Recall: 0.8413
2025-08-21 11:23:57,624 - INFO - Val   - Loss: 0.3940, Acc: 0.8382, F1: 0.8362, Precision: 0.8447, Recall: 0.8382
2025-08-21 11:23:57,626 - INFO - 
=== Epoch 24/30 ===
2025-08-21 11:24:51,857 - INFO - Train - Loss: 0.4360, Acc: 0.8216, F1: 0.8202, Precision: 0.8215, Recall: 0.8216
2025-08-21 11:24:51,858 - INFO - Val   - Loss: 0.4136, Acc: 0.8225, F1: 0.8210, Precision: 0.8373, Recall: 0.8225
2025-08-21 11:24:51,860 - INFO - 
=== Epoch 25/30 ===
2025-08-21 11:25:46,322 - INFO - Train - Loss: 0.4187, Acc: 0.8368, F1: 0.8357, Precision: 0.8369, Recall: 0.8368
2025-08-21 11:25:46,323 - INFO - Val   - Loss: 0.4057, Acc: 0.8273, F1: 0.8264, Precision: 0.8395, Recall: 0.8273
2025-08-21 11:25:46,325 - INFO - 
=== Epoch 26/30 ===
2025-08-21 11:26:40,573 - INFO - Train - Loss: 0.4132, Acc: 0.8371, F1: 0.8363, Precision: 0.8373, Recall: 0.8371
2025-08-21 11:26:40,574 - INFO - Val   - Loss: 0.4011, Acc: 0.8261, F1: 0.8241, Precision: 0.8337, Recall: 0.8261
2025-08-21 11:26:40,576 - INFO - 
=== Epoch 27/30 ===
2025-08-21 11:27:34,892 - INFO - Train - Loss: 0.4014, Acc: 0.8337, F1: 0.8333, Precision: 0.8346, Recall: 0.8337
2025-08-21 11:27:34,893 - INFO - Val   - Loss: 0.3982, Acc: 0.8297, F1: 0.8278, Precision: 0.8365, Recall: 0.8297
2025-08-21 11:27:34,895 - INFO - 
=== Epoch 28/30 ===
2025-08-21 11:28:29,273 - INFO - Train - Loss: 0.4085, Acc: 0.8304, F1: 0.8294, Precision: 0.8305, Recall: 0.8304
2025-08-21 11:28:29,274 - INFO - Val   - Loss: 0.3996, Acc: 0.8309, F1: 0.8289, Precision: 0.8382, Recall: 0.8309
2025-08-21 11:28:29,276 - INFO - 
=== Epoch 29/30 ===
2025-08-21 11:29:23,616 - INFO - Train - Loss: 0.4072, Acc: 0.8395, F1: 0.8387, Precision: 0.8397, Recall: 0.8395
2025-08-21 11:29:23,617 - INFO - Val   - Loss: 0.3987, Acc: 0.8333, F1: 0.8314, Precision: 0.8408, Recall: 0.8333
2025-08-21 11:29:23,619 - INFO - 
=== Epoch 30/30 ===
2025-08-21 11:30:17,916 - INFO - Train - Loss: 0.4143, Acc: 0.8350, F1: 0.8340, Precision: 0.8345, Recall: 0.8350
2025-08-21 11:30:17,917 - INFO - Val   - Loss: 0.3984, Acc: 0.8321, F1: 0.8302, Precision: 0.8395, Recall: 0.8321
2025-08-21 11:30:20,569 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_combined_20250821_104017/last_model.pth
2025-08-21 11:30:24,581 - INFO - === DETAILED EVALUATION RESULTS ===
2025-08-21 11:30:24,583 - INFO - Overall Accuracy: 0.8321
2025-08-21 11:30:24,583 - INFO - Macro F1-Score: 0.8014
2025-08-21 11:30:24,585 - INFO - Micro F1-Score: 0.8321
2025-08-21 11:30:24,597 - INFO - Weighted F1-Score: 0.8302
2025-08-21 11:30:24,598 - INFO - Per-class Accuracy:
2025-08-21 11:30:24,599 - INFO -   angry: 0.7962
2025-08-21 11:30:24,600 - INFO -   disgust: 0.9730
2025-08-21 11:30:24,602 - INFO -   fear: 0.8219
2025-08-21 11:30:24,603 - INFO -   happy: 0.7975
2025-08-21 11:30:24,604 - INFO -   neutral: 0.3810
2025-08-21 11:30:24,605 - INFO -   sad: 0.8497
2025-08-21 11:30:24,606 - INFO -   surprised: 0.9600
2025-08-21 11:30:24,607 - INFO - Final evaluation completed with comprehensive metrics
2025-08-21 11:30:26,456 - INFO - Training completed!
