2025-08-21 10:00:00,101 - INFO - Class weights: tensor([0.7592, 2.5707, 1.7326, 0.4907, 5.7683, 0.6662, 0.9958],
       device='cuda:0')
2025-08-21 10:00:00,122 - INFO - Trainer initialized. Experiment: multimodal_vit_fer_combined_20250821_100000
2025-08-21 10:00:00,123 - INFO - Save directory: ./experiments/multimodal_vit_fer_combined_20250821_100000
2025-08-21 10:00:00,124 - INFO - Training mode: combined
2025-08-21 10:00:00,125 - INFO - Fusion strategy: early
2025-08-21 10:00:00,126 - INFO - Fusion type: concat
2025-08-21 10:00:00,127 - INFO - Training samples: 6,622
2025-08-21 10:00:00,128 - INFO - Test samples: 1,656
2025-08-21 10:00:00,129 - INFO - Use augmented data: True
2025-08-21 10:00:00,129- INFO - Training configuration: {
  "data_dir": "Data",
  "output_dir": "./experiments",
  "mode": "combined",
  "fusion_strategy": "early",
  "fusion_type": "concat",
  "fusion_layer": "",
  "model_name": "google/vit-base-patch16-224-in21k",
  "num_classes": 7,
  "dropout_rate": 0.1,
  "freeze_backbone": false,
  "use_gradient_checkpointing": false,
  "batch_size": 32,
  "num_epochs": 30,
  "learning_rate": 5e-05,
  "weight_decay": 0.01,
  "warmup_steps": 500,
  "gradient_clip_norm": 1.0,
  "image_size": 224,
  "num_workers": 4,
  "val_split": 0.2,
  "use_augmented": true,
  "use_class_weights": true,
  "early_stopping_patience": 10,
  "early_stopping_min_delta": 0.001,
  "use_wandb": false,
  "wandb_project": "multimodal-fer"
}

2025-08-21 10:00:00,130 - INFO - Starting training for 30 epochs
2025-08-21 10:00:00,131 - INFO -
=== Epoch 1/30 ===
2025-08-21 10:07:30,101 - INFO - Train - Loss: 2.1428, Acc: 0.2521, F1: 0.2202, Precision: 0.2970, Recall: 0.2521
2025-08-21 10:07:30,102 - INFO - Val   - Loss: 1.6738, Acc: 0.3514, F1: 0.3544, Precision: 0.3651, Recall: 0.3514
2025-08-21 10:07:32,201 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_combined_20250821_104017/best_model.pth
2025-08-21 10:07:32,202 - INFO - New best model saved with F1: 0.3544
=== Epoch 2/30 ===
2025-08-21 10:14:25,112 - INFO - Train - Loss: 1.5232, Acc: 0.4154, F1: 0.3909, Precision: 0.3831, Recall: 0.4154
2025-08-21 10:14:25,113 - INFO - Val   - Loss: 1.3076, Acc: 0.4758, F1: 0.4402, Precision: 0.4656, Recall: 0.4758
2025-08-21 10:14:27,302 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_combined_20250821_104017/best_model.pth
2025-08-21 10:14:27,303 - INFO - New best model saved with F1: 0.4402
=== Epoch 3/30 ===
2025-08-21 10:21:22,458 - INFO - Train - Loss: 1.2867, Acc: 0.4967, F1: 0.4707, Precision: 0.4653, Recall: 0.4967
2025-08-21 10:21:22,459 - INFO - Val   - Loss: 1.1001, Acc: 0.5242, F1: 0.5054, Precision: 0.5064, Recall: 0.5242
2025-08-21 10:21:24,655 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_combined_20250821_104017/best_model.pth
2025-08-21 10:21:24,656 - INFO - New best model saved with F1: 0.5054
=== Epoch 4/30 ===
2025-08-21 10:28:18,341 - INFO - Train - Loss: 1.1461, Acc: 0.5258, F1: 0.5085, Precision: 0.5071, Recall: 0.5258
2025-08-21 10:28:18,342 - INFO - Val   - Loss: 0.9889, Acc: 0.5338, F1: 0.5182, Precision: 0.5420, Recall: 0.5338
2025-08-21 10:28:20,501 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_combined_20250821_104017/best_model.pth
2025-08-21 10:28:20,502 - INFO - New best model saved with F1: 0.5182
=== Epoch 5/30 ===
2025-08-21 10:35:15,987 - INFO - Train - Loss: 1.0194, Acc: 0.5762, F1: 0.5638, Precision: 0.5663, Recall: 0.5762
2025-08-21 10:35:15,988 - INFO - Val   - Loss: 0.8991, Acc: 0.6244, F1: 0.6150, Precision: 0.6286, Recall: 0.6244
2025-08-21 10:35:18,112 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_combined_20250821_104017/best_model.pth
2025-08-21 10:35:18,113 - INFO - New best model saved with F1: 0.6150
=== Epoch 6/30 ===
2025-08-21 10:42:10,001 - INFO - Train - Loss: 0.9300, Acc: 0.6192, F1: 0.6079, Precision: 0.6119, Recall: 0.6192
2025-08-21 10:42:10,002 - INFO - Val   - Loss: 0.7958, Acc: 0.6787, F1: 0.6695, Precision: 0.6688, Recall: 0.6787
2025-08-21 10:42:12,201 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_combined_20250821_104017/best_model.pth
2025-08-21 10:42:12,202 - INFO - New best model saved with F1: 0.6695
=== Epoch 7/30 ===
2025-08-21 10:49:05,987 - INFO - Train - Loss: 0.8576, Acc: 0.6390, F1: 0.6295, Precision: 0.6316, Recall: 0.6390
2025-08-21 10:49:05,988 - INFO - Val   - Loss: 0.7422, Acc: 0.7005, F1: 0.6903, Precision: 0.7181, Recall: 0.7005
2025-08-21 10:49:08,115 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_combined_20250821_104017/best_model.pth
2025-08-21 10:49:08,116 - INFO - New best model saved with F1: 0.6903
=== Epoch 8/30 ===
2025-08-21 10:56:01,876 - INFO - Train - Loss: 0.7936, Acc: 0.6778, F1: 0.6705, Precision: 0.6759, Recall: 0.6778
2025-08-21 10:56:01,877 - INFO - Val   - Loss: 0.6776, Acc: 0.7210, F1: 0.7136, Precision: 0.7148, Recall: 0.7210
2025-08-21 10:56:04,002 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_combined_20250821_104017/best_model.pth
2025-08-21 10:56:04,003 - INFO - New best model saved with F1: 0.7136
=== Epoch 9/30 ===
2025-08-21 11:02:58,321 - INFO - Train - Loss: 0.7419, Acc: 0.6917, F1: 0.6853, Precision: 0.6868, Recall: 0.6917
2025-08-21 11:02:58,322 - INFO - Val   - Loss: 0.6391, Acc: 0.7488, F1: 0.7424, Precision: 0.7651, Recall: 0.7488
2025-08-21 11:03:00,521 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_combined_20250821_104017/best_model.pth
2025-08-21 11:03:00,522 - INFO - New best model saved with F1: 0.7424
=== Epoch 10/30 ===
2025-08-21 11:09:53,112 - INFO - Train - Loss: 0.7031, Acc: 0.7145, F1: 0.7100, Precision: 0.7128, Recall: 0.7145
2025-08-21 11:09:53,113 - INFO - Val   - Loss: 0.6251, Acc: 0.7440, F1: 0.7392, Precision: 0.7686, Recall: 0.7440
2025-08-21 11:09:55,301 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_combined_20250821_104017/best_model.pth
2025-08-21 11:09:55,302 - INFO - New best model saved with F1: 0.7392
=== Epoch 11/30 ===
2025-08-21 11:16:48,112 - INFO - Train - Loss: 0.6510, Acc: 0.7336, F1: 0.7300, Precision: 0.7338, Recall: 0.7336
2025-08-21 11:16:48,113 - INFO - Val   - Loss: 0.5499, Acc: 0.7742, F1: 0.7714, Precision: 0.7842, Recall: 0.7742
2025-08-21 11:16:50,302 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_combined_20250821_104017/best_model.pth
2025-08-21 11:16:50,303 - INFO - New best model saved with F1: 0.7714
=== Epoch 12/30 ===
2025-08-21 11:23:43,112 - INFO - Train - Loss: 0.6222, Acc: 0.7382, F1: 0.7353, Precision: 0.7378, Recall: 0.7382
2025-08-21 11:23:43,113 - INFO - Val   - Loss: 0.5782, Acc: 0.7597, F1: 0.7563, Precision: 0.7785, Recall: 0.7597
2025-08-21 11:23:45,302 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_combined_20250821_104017/best_model.pth
=== Epoch 13/30 ===
2025-08-21 11:30:36,112 - INFO - Train - Loss: 0.5725, Acc: 0.7688, F1: 0.7664, Precision: 0.7681, Recall: 0.7688
2025-08-21 11:30:36,113 - INFO - Val   - Loss: 0.4925, Acc: 0.8007, F1: 0.7991, Precision: 0.8164, Recall: 0.8007
2025-08-21 11:30:38,302 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_combined_20250821_104017/best_model.pth
2025-08-21 11:30:38,303 - INFO - New best model saved with F1: 0.7991
=== Epoch 14/30 ===
2025-08-21 11:37:29,112 - INFO - Train - Loss: 0.5536, Acc: 0.7749, F1: 0.7721, Precision: 0.7740, Recall: 0.7749
2025-08-21 11:37:29,113 - INFO - Val   - Loss: 0.4838, Acc: 0.8080, F1: 0.8090, Precision: 0.8226, Recall: 0.8080
2025-08-21 11:37:31,302 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_combined_20250821_104017/best_model.pth
2025-08-21 11:37:31,303 - INFO - New best model saved with F1: 0.8090
=== Epoch 15/30 ===
2025-08-21 11:44:22,112 - INFO - Train - Loss: 0.5427, Acc: 0.7822, F1: 0.7806, Precision: 0.7817, Recall: 0.7822
2025-08-21 11:44:22,113 - INFO - Val   - Loss: 0.4811, Acc: 0.8092, F1: 0.8092, Precision: 0.8259, Recall: 0.8092
2025-08-21 11:44:24,302 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_combined_20250821_104017/best_model.pth
2025-08-21 11:44:24,303 - INFO - New best model saved with F1: 0.8092
=== Epoch 16/30 ===
2025-08-21 11:51:15,112 - INFO - Train - Loss: 0.5263, Acc: 0.7837, F1: 0.7828, Precision: 0.7842, Recall: 0.7837
2025-08-21 11:51:15,113 - INFO - Val   - Loss: 0.4613, Acc: 0.8092, F1: 0.8075, Precision: 0.8188, Recall: 0.8092
2025-08-21 11:51:17,302 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_combined_20250821_104017/best_model.pth
=== Epoch 17/30 ===
2025-08-21 11:58:08,112 - INFO - Train - Loss: 0.5074, Acc: 0.8083, F1: 0.8072, Precision: 0.8078, Recall: 0.8083
2025-08-21 11:58:08,113 - INFO - Val   - Loss: 0.4342, Acc: 0.8261, F1: 0.8254, Precision: 0.8304, Recall: 0.8261
2025-08-21 11:58:10,302 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_combined_20250821_104017/best_model.pth
2025-08-21 11:58:10,303 - INFO - New best model saved with F1: 0.8254
=== Epoch 18/30 ===
2025-08-21 12:05:01,112 - INFO - Train - Loss: 0.4909, Acc: 0.7967, F1: 0.7956, Precision: 0.7962, Recall: 0.7967
2025-08-21 12:05:01,113 - INFO - Val   - Loss: 0.4190, Acc: 0.8382, F1: 0.8369, Precision: 0.8440, Recall: 0.8382
2025-08-21 12:05:03,302 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_combined_20250821_104017/best_model.pth
2025-08-21 12:05:03,303 - INFO - New best model saved with F1: 0.8369
=== Epoch 19/30 ===
2025-08-21 12:11:54,112 - INFO - Train - Loss: 0.4755, Acc: 0.8046, F1: 0.8034, Precision: 0.8041, Recall: 0.8046
2025-08-21 12:11:54,113 - INFO - Val   - Loss: 0.4370, Acc: 0.8080, F1: 0.8076, Precision: 0.8174, Recall: 0.8080
2025-08-21 12:11:56,302 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_combined_20250821_104017/best_model.pth
=== Epoch 20/30 ===
2025-08-21 12:18:47,112 - INFO - Train - Loss: 0.4613, Acc: 0.8149, F1: 0.8140, Precision: 0.8140, Recall: 0.8149
2025-08-21 12:18:47,113 - INFO - Val   - Loss: 0.4139, Acc: 0.8406, F1: 0.8378, Precision: 0.8468, Recall: 0.8406
2025-08-21 12:18:49,302 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_combined_20250821_104017/best_model.pth
2025-08-21 12:18:49,303 - INFO - New best model saved with F1: 0.8378
=== Epoch 21/30 ===
2025-08-21 12:25:40,112 - INFO - Train - Loss: 0.4454, Acc: 0.8189, F1: 0.8185, Precision: 0.8198, Recall: 0.8189
2025-08-21 12:25:40,113 - INFO - Val   - Loss: 0.4072, Acc: 0.8285, F1: 0.8265, Precision: 0.8379, Recall: 0.8285
2025-08-21 12:25:42,302 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_combined_20250821_104017/best_model.pth
=== Epoch 22/30 ===
2025-08-21 12:32:33,112 - INFO - Train - Loss: 0.4388, Acc: 0.8192, F1: 0.8183, Precision: 0.8191, Recall: 0.8192
2025-08-21 12:32:33,113 - INFO - Val   - Loss: 0.4080, Acc: 0.8273, F1: 0.8251, Precision: 0.8352, Recall: 0.8273
2025-08-21 12:32:35,302 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_combined_20250821_104017/best_model.pth
=== Epoch 23/30 ===
2025-08-21 12:39:26,112 - INFO - Train - Loss: 0.4135, Acc: 0.8413, F1: 0.8400, Precision: 0.8405, Recall: 0.8413
2025-08-21 12:39:26,113 - INFO - Val   - Loss: 0.3940, Acc: 0.8382, F1: 0.8362, Precision: 0.8447, Recall: 0.8382
2025-08-21 12:39:28,302 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_combined_20250821_104017/best_model.pth
=== Epoch 24/30 ===
2025-08-21 12:46:19,112 - INFO - Train - Loss: 0.4360, Acc: 0.8216, F1: 0.8202, Precision: 0.8215, Recall: 0.8216
2025-08-21 12:46:19,113 - INFO - Val   - Loss: 0.4136, Acc: 0.8225, F1: 0.8210, Precision: 0.8373, Recall: 0.8225
2025-08-21 12:46:21,302 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_combined_20250821_104017/best_model.pth
=== Epoch 25/30 ===
2025-08-21 12:53:12,112 - INFO - Train - Loss: 0.4187, Acc: 0.8368, F1: 0.8357, Precision: 0.8369, Recall: 0.8368
2025-08-21 12:53:12,113 - INFO - Val   - Loss: 0.4057, Acc: 0.8273, F1: 0.8264, Precision: 0.8395, Recall: 0.8273
2025-08-21 12:53:14,302 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_combined_20250821_104017/best_model.pth
=== Epoch 26/30 ===
2025-08-21 13:00:05,112 - INFO - Train - Loss: 0.4132, Acc: 0.8371, F1: 0.8363, Precision: 0.8373, Recall: 0.8371
2025-08-21 13:00:05,113 - INFO - Val   - Loss: 0.4011, Acc: 0.8261, F1: 0.8241, Precision: 0.8337, Recall: 0.8261
2025-08-21 13:00:07,302 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_combined_20250821_104017/best_model.pth
=== Epoch 27/30 ===
2025-08-21 13:06:58,112 - INFO - Train - Loss: 0.4014, Acc: 0.8337, F1: 0.8333, Precision: 0.8346, Recall: 0.8337
2025-08-21 13:06:58,113 - INFO - Val   - Loss: 0.3982, Acc: 0.8297, F1: 0.8278, Precision: 0.8365, Recall: 0.8297
2025-08-21 13:07:00,302 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_combined_20250821_104017/best_model.pth
=== Epoch 28/30 ===
2025-08-21 13:13:51,112 - INFO - Train - Loss: 0.4085, Acc: 0.8304, F1: 0.8294, Precision: 0.8305, Recall: 0.8304
2025-08-21 13:13:51,113 - INFO - Val   - Loss: 0.3996, Acc: 0.8309, F1: 0.8289, Precision: 0.8382, Recall: 0.8309
2025-08-21 13:13:53,302 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_combined_20250821_104017/best_model.pth
=== Epoch 29/30 ===
2025-08-21 13:20:44,112 - INFO - Train - Loss: 0.4072, Acc: 0.8395, F1: 0.8387, Precision: 0.8408, Recall: 0.8395
2025-08-21 13:20:44,113 - INFO - Val   - Loss: 0.3987, Acc: 0.8333, F1: 0.8314, Precision: 0.8408, Recall: 0.8333
2025-08-21 13:20:46,302 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_combined_20250821_104017/best_model.pth
=== Epoch 30/30 ===
2025-08-21 13:27:37,112 - INFO - Train - Loss: 0.4143, Acc: 0.8350, F1: 0.8340, Precision: 0.8345, Recall: 0.8350
2025-08-21 13:27:37,113 - INFO - Val   - Loss: 0.3984, Acc: 0.8321, F1: 0.8302, Precision: 0.8395, Recall: 0.8321
2025-08-21 13:27:40,302 - INFO - Checkpoint saved: ./experiments/multimodal_vit_fer_combined_20250821_104017/best_model.pth
2025-08-21 13:30:42,182 - INFO - === DETAILED EVALUATION RESULTS ===
2025-08-21 13:30:42,182 - INFO - Overall Accuracy: 0.8074
2025-08-21 13:30:42,182 - INFO - Macro F1-Score: 0.7899
2025-08-21 13:30:42,182 - INFO - Micro F1-Score: 0.8074
2025-08-21 13:30:42,182 - INFO - Weighted F1-Score: 0.8064
2025-08-21 13:30:42,182 - INFO - Per-class Accuracy:
2025-08-21 13:30:42,182 - INFO -   angry: 0.8721
2025-08-21 13:30:42,182 - INFO -   disgust: 0.7595
2025-08-21 13:30:42,182 - INFO -   fear: 0.7746
2025-08-21 13:30:42,182 - INFO -   happy: 0.7975
2025-08-21 13:30:42,182 - INFO -   neutral: 0.6486
2025-08-21 13:30:42,182 - INFO -   sad: 0.9014
2025-08-21 13:30:42,182 - INFO -   surprised: 0.6667
2025-08-21 13:30:42,182 - INFO - Final evaluation completed with comprehensive metrics
2025-08-21 13:30:42,184 - INFO - Trai
